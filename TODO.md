
# PROBLEMS

## **Problem#01** - `initialise_collections` in `registrar`

There seems to be a race-condition during startup - when `resource-catalogue` and `data-access` are deployed from clean all at once. After initial deployment the collections have not been recreated and there are errors in the registrar log. The remedy is to then delete the `registrar` pod - forcing it to be recreated - and then the `initialise-collections` is successful.

This has been raised as a Jira ticket - https://eoepca.atlassian.net/browse/EOEPCA-731

## **Problem#02** - WMS service

There seems to be a problem with WMS service on the `develop` cluster, but not on the `demo` cluster.

The problem is the GetMap request which simply times-out - and can be demonstrated with both the `05 Data Access` Jupyter notebook, and with QGIS - both of which work fine with the `demo` cluster.

This is the [request generated by QGIS](https://data-access.develop.eoepca.org/ows?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&BBOX=1815830.94197272067,5914797.41638581641,1981803.827413877472,6081259.759856631979&CRS=EPSG:3857&WIDTH=516&HEIGHT=519&LAYERS=S2B_MSIL1C_20190910T095029_N0208_R079_T33TXN_20190910T120910.SAFE__TRUE_COLOR&STYLES=&FORMAT=image/png&DPI=96&MAP_RESOLUTION=96&FORMAT_OPTIONS=dpi:96&TRANSPARENT=TRUE) - https://data-access.develop.eoepca.org/ows?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&BBOX=1815830.94197272067,5914797.41638581641,1981803.827413877472,6081259.759856631979&CRS=EPSG:3857&WIDTH=516&HEIGHT=519&LAYERS=S2B_MSIL1C_20190910T095029_N0208_R079_T33TXN_20190910T120910.SAFE__TRUE_COLOR&STYLES=&FORMAT=image/png&DPI=96&MAP_RESOLUTION=96&FORMAT_OPTIONS=dpi:96&TRANSPARENT=TRUE.

> **Notes:**
> * the problem also occurs in my local cluster that is aligned with the develop cluster (same image tags etc.) - so maybe recent data-access updates are to blame
> * the problem does **not** occur with the `__outlines` layer.

## **Problem#03** - Zooming Leaflet/Folium map breaks `renderer`

The demo Jupyter notebook for data access uses the folium library to render a scene as a layer in Leaflet. If this view it zoomed-in then the view is not properly refreshed and the `renderer` pods go into the `Not Ready` state.

At the instant of the zoom-in the `regisrar` logs report...

```
{"event": "Loading the EOxServer configuration. Using paths: /usr/local/lib/python3.10/dist-packages/eoxserver/conf/default.conf, /usr/eoxserver/conf/default.conf, /var/www/pvs/dev/pvs_instance/pvs_instance/conf/eoxserver.conf."}
{"event": "Loading the EOxServer configuration. Using paths: /usr/local/lib/python3.10/dist-packages/eoxserver/conf/default.conf, /usr/eoxserver/conf/default.conf, /var/www/pvs/dev/pvs_instance/pvs_instance/conf/eoxserver.conf."}
```

Followed, after some seconds, by...

```
[2022-09-15 08:49:05 +0000] [56] [CRITICAL] WORKER TIMEOUT (pid:103)
[2022-09-15 08:49:07 +0000] [56] [WARNING] Worker with pid 103 was terminated due to signal 9
{"event": "Loading the EOxServer configuration. Using paths: /usr/local/lib/python3.10/dist-packages/eoxserver/conf/default.conf, /usr/eoxserver/conf/default.conf, /var/www/pvs/dev/pvs_instance/pvs_instance/conf/eoxserver.conf."}
[2022-09-15 08:49:08 +0000] [56] [CRITICAL] WORKER TIMEOUT (pid:94)
[2022-09-15 08:49:09 +0000] [56] [WARNING] Worker with pid 94 was terminated due to signal 9
{"event": "Loading the EOxServer configuration. Using paths: /usr/local/lib/python3.10/dist-packages/eoxserver/conf/default.conf, /usr/eoxserver/conf/default.conf, /var/www/pvs/dev/pvs_instance/pvs_instance/conf/eoxserver.conf."}
[2022-09-15 08:49:30 +0000] [56] [CRITICAL] WORKER TIMEOUT (pid:88)
[2022-09-15 08:49:30 +0000] [56] [CRITICAL] WORKER TIMEOUT (pid:97)
[2022-09-15 08:49:30 +0000] [56] [CRITICAL] WORKER TIMEOUT (pid:116)
[2022-09-15 08:49:30 +0000] [56] [CRITICAL] WORKER TIMEOUT (pid:127)
[2022-09-15 08:49:31 +0000] [56] [CRITICAL] WORKER TIMEOUT (pid:100)
[2022-09-15 08:49:31 +0000] [56] [CRITICAL] WORKER TIMEOUT (pid:106)
[2022-09-15 08:49:31 +0000] [56] [WARNING] Worker with pid 88 was terminated due to signal 9
[2022-09-15 08:49:31 +0000] [56] [WARNING] Worker with pid 97 was terminated due to signal 9
[2022-09-15 08:49:31 +0000] [56] [WARNING] Worker with pid 127 was terminated due to signal 9
[2022-09-15 08:49:31 +0000] [56] [WARNING] Worker with pid 116 was terminated due to signal 9
[2022-09-15 08:49:31 +0000] [56] [WARNING] Worker with pid 106 was terminated due to signal 9
[2022-09-15 08:49:31 +0000] [56] [WARNING] Worker with pid 100 was terminated due to signal 9

more...
```

Eventually (some minutes) then `renderer` pods recover to `Running` state

## **Problem#04** - View Server map not removing de-filtered scenes

Experimenting with the Cloud Cover filter in the View Server - select a value 0-20% and the Search Results updates to filter the matching scenes - but the map view does not remove the cloudy scenes.

Is this what is expected?

This has been raised as Jira ticket - https://eoepca.atlassian.net/browse/EOEPCA-732


# QUESTIONS

## Question#01 - WCS download URL lists

The View Server allows to download URL lists for a product - ref. `url-list.txt` / `download-files.meta4` - e.g. `https://data-access-open.platform-22-09-15-03.guide.eoepca.org/ows?service=WCS&version=2.0.1&request=GetCoverage&coverageid=S2B_MSIL1C_20190910T095029_N0208_R079_T33UWP_20190910T120910.SAFE_B01`.

How can these be exploited?

* When the URL is used in a browser then the error `Format could not be determined` is returned.
* Perhaps a content-type must be expressed in the http request - if so, what types?

## Question#02 - Product downloads

The View Server allows to download the product (TIFF, JPEG2000, HDF).

* Is this WCS download?
* Are these downloads the full product, or a 'visual' representation based upon the current layer selection?

## Question#03 - View Server 3D mode

How is this enabled?
