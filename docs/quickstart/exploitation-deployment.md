# Exploitation Deployment

A deployment wrapper script has been prepared for an 'exploitation' deployment - that provides deployment/execution of processing via the ADES, supported by Resource Catalogue and Data Access services.

The script [`deploy/exploitation/exploitation`](https://github.com/EOEPCA/deployment-guide/blob/main/deploy/exploitation/exploitation) achieves this by appropriate [configuration of the environment variables](scripted-deployment.md#environment-variables), before launching the [eoepca.sh deployment script](scripted-deployment.md#command-line-arguments). The deployment configuration is captured in the file [`deploy/exploitation/exploitation-options`](https://github.com/EOEPCA/deployment-guide/blob/main/deploy/exploitation/exploitation-options).

The exploitation deployment applies the following configuration:

* Assumes a private deployment - i.e. no external-facing IP/ingress, and hence no TLS<br>
  _To configure an external-facing deployment with TLS protection, then see section [Public Deployment](scripted-deployment.md#public-deployment)_
* No TLS for service ingress endpoints
* Services deployed:
    * ADES for processing
    * Resource Catalogue for data discovery
    * Data Access for data visualisation and download
    * Minio for S3 object storage
* ADES stage-out to Minio
* Includes data specification for CREODIAS Sentinel-2, which can be exploited if running in a CREODIAS VM connected to the `eodata` network - [see description of variable `CREODIAS_DATA_SPECIFICATION`](scripted-deployment.md#environment-variables)
* Open ingress are enabled for unauthenticated access to ADES, resource-catalogue and data-access services
* Other eoepca services not deployed

## Initiate Deployment

Deployment is initiated by invoking the script...

```
./deploy/exploitation/exploitation
```

The ADES service is accessed at the endpoint `ades-open.<domain>` - e.g. `ades-open.192-168-49-2.nip.io`.

The Resource Catalogue is accessed at the endpoint `resource-catalogue-open.<domain>` - e.g. `resource-catalogue-open.192-168-49-2.nip.io`.

The Data Access View Server is accessed at the endpoint `data-access-open.<domain>` - e.g. `data-access-open.192-168-49-2.nip.io`.

## Example Requests - `s-expression` on CREODIAS

> NOTE that this example processing request requires harvesting data from CREODIAS, which can only be performed if the deployment is made to a CREODIAS VM with access to the `eodata` network - [see description of variable `CREODIAS_DATA_SPECIFICATION`](scripted-deployment.md#environment-variables).

Section [Processing](processing-deployment.md) provides an example of a [simple self-contained processing deployment and execution](processing-deployment.md#example-requests), and [access to the processing results](processing-deployment.md#processing-results).

In addition to the `snuggs` example, the file [`deploy/samples/requests/processing/s-expression.http`](https://github.com/EOEPCA/deployment-guide/blob/main/deploy/samples/requests/processing/s-expression.http) has been prepared to exploit data that has been registered within the _Resource Catalogue_ and _Data Access_ services.

First the input data for processing must be harvested into the resource management services.<br>
**_Sentinel-2 data on 2nd Sept 2020..._**

```
./deploy/bin/harvest ./deploy/samples/harvester/config-Sentinel2-2020.09.02.yaml
```

Then the [`s-expression.http`](https://github.com/EOEPCA/deployment-guide/blob/main/deploy/samples/requests/processing/s-expression.http) file provides sample requests for **_OGC API Processes_** operations:

* List Processes
* Deploy Process
* Get Process Details
* Execute Process
* Get Job Status
* Get Job Results

> NOTE that the first requests in the file provide optional calls to obtain a user ID token (`openidConfiguration` / `authenticate`) - to be used in the case that protected (not 'open') endpoints are deployed.

The file `snuggs.http` describes the HTTP requests for the ADES OGC API Processes endpoint, and is designed for use with the Visual Studio Code (vscode) extension [REST Client](https://marketplace.visualstudio.com/items?itemName=humao.rest-client). Install in vscode with `ext install humao.rest-client`.

Various variables, such as to specify the `@domain` for your deployment, can be configured at the top of the file.

At the completion of successful processing execution, the procesing results are obtained as described in section [Processing Results](processing-deployment.md#processing-results).

## Data Harvesting

See section [Harvest CREODIAS Data](creodias-deployment.md#harvest-creodias-data) to harvest the default data specification from the CREODIAS data offering.
