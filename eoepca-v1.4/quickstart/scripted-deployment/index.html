
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://deployment-guide.docs.eoepca.org/eoepca-v1.4/quickstart/scripted-deployment/">
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.8">
    
    
      
        <title>Scripted Deployment - EOEPCA Deployment Guide</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#scripted-deployment" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../../..">
    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          
        </aside>
      </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="EOEPCA Deployment Guide" class="md-header__button md-logo" aria-label="EOEPCA Deployment Guide" data-md-component="logo">
      
  <img src="../../img/favicon.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EOEPCA Deployment Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Scripted Deployment
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/EOEPCA/deployment-guide" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link md-tabs__link--active">
        Deployment Guide
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="EOEPCA Deployment Guide" class="md-nav__button md-logo" aria-label="EOEPCA Deployment Guide" data-md-component="logo">
      
  <img src="../../img/favicon.ico" alt="logo">

    </a>
    EOEPCA Deployment Guide
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/EOEPCA/deployment-guide" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Deployment Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deployment Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Deployment Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2" type="checkbox" id="__nav_1_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1_2">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        Quick Start
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Scripted Deployment
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Scripted Deployment
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    Environment Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-line-arguments" class="md-nav__link">
    Command-line Arguments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#public-deployment" class="md-nav__link">
    Public Deployment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    Deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#post-deployment-manual-steps" class="md-nav__link">
    Post-deployment Manual Steps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#default-credentials" class="md-nav__link">
    Default Credentials
  </a>
  
    <nav class="md-nav" aria-label="Default Credentials">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#identity-service" class="md-nav__link">
    Identity Service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#minio-object-storage" class="md-nav__link">
    Minio Object Storage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#harbor-container-registry" class="md-nav__link">
    Harbor Container Registry
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protection" class="md-nav__link">
    Protection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-users" class="md-nav__link">
    Test Users
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-workspace-creation" class="md-nav__link">
    User Workspace Creation
  </a>
  
    <nav class="md-nav" aria-label="User Workspace Creation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-workspace-swagger-ui" class="md-nav__link">
    Using Workspace Swagger UI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-curl" class="md-nav__link">
    Using curl
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-create-workspace-helper-script" class="md-nav__link">
    Using create-workspace helper script
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#eoepca-portal" class="md-nav__link">
    EOEPCA Portal
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    Clean-up
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2_3" type="checkbox" id="__nav_1_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_2_3">
          Profiles
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Profiles" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_2_3">
          <span class="md-nav__icon md-icon"></span>
          Profiles
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../simple-deployment/" class="md-nav__link">
        Simple
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../processing-deployment/" class="md-nav__link">
        Processing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../application-hub-deployment/" class="md-nav__link">
        Application Hub
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data-access-deployment/" class="md-nav__link">
        Data Access
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../exploitation-deployment/" class="md-nav__link">
        Exploitation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../userman-deployment/" class="md-nav__link">
        User Management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../creodias-deployment/" class="md-nav__link">
        CREODIAS Data
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_3" type="checkbox" id="__nav_1_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_3">
          Prepare Cluster
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Prepare Cluster" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          Prepare Cluster
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/prerequisite-tooling/" class="md-nav__link">
        Prerequisite Tooling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/kubernetes/" class="md-nav__link">
        Kubernetes Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/helm-repositories/" class="md-nav__link">
        Helm Repositories
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/cluster-prerequisites/" class="md-nav__link">
        Cluster Prerequisites
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_4" type="checkbox" id="__nav_1_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_4">
          Deploy EOEPCA Components
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deploy EOEPCA Components" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_4">
          <span class="md-nav__icon md-icon"></span>
          Deploy EOEPCA Components
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/persistence/" class="md-nav__link">
        Persistence
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_4_2" type="checkbox" id="__nav_1_4_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_4_2">
          Identity & Access Management
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Identity & Access Management" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_4_2">
          <span class="md-nav__icon md-icon"></span>
          Identity & Access Management
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/iam-overview/" class="md-nav__link">
        IAM Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_4_2_2" type="checkbox" id="__nav_1_4_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_4_2_2">
          Keycloak Solution (NEW)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Keycloak Solution (NEW)" data-md-level="4">
        <label class="md-nav__title" for="__nav_1_4_2_2">
          <span class="md-nav__icon md-icon"></span>
          Keycloak Solution (NEW)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/identity-service/" class="md-nav__link">
        Identity Service
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/resource-protection-keycloak/" class="md-nav__link">
        Resource Protection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_4_2_3" type="checkbox" id="__nav_1_4_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_4_2_3">
          Gluu Solution (deprecated)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Gluu Solution (deprecated)" data-md-level="4">
        <label class="md-nav__title" for="__nav_1_4_2_3">
          <span class="md-nav__icon md-icon"></span>
          Gluu Solution (deprecated)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/login-service/" class="md-nav__link">
        Login Service
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/pdp/" class="md-nav__link">
        Policy Decision Point
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/resource-protection-gluu/" class="md-nav__link">
        Resource Protection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/user-profile/" class="md-nav__link">
        User Profile
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/ades-zoo/" class="md-nav__link">
        ADES (Processing)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/application-hub/" class="md-nav__link">
        Application Hub
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/resource-catalogue/" class="md-nav__link">
        Resource Catalogue
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/data-access/" class="md-nav__link">
        Data Access
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/registration-api/" class="md-nav__link">
        Registration API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/workspace/" class="md-nav__link">
        Workspace
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/container-registry/" class="md-nav__link">
        Container Registry
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    Environment Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-line-arguments" class="md-nav__link">
    Command-line Arguments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#public-deployment" class="md-nav__link">
    Public Deployment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    Deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#post-deployment-manual-steps" class="md-nav__link">
    Post-deployment Manual Steps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#default-credentials" class="md-nav__link">
    Default Credentials
  </a>
  
    <nav class="md-nav" aria-label="Default Credentials">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#identity-service" class="md-nav__link">
    Identity Service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#minio-object-storage" class="md-nav__link">
    Minio Object Storage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#harbor-container-registry" class="md-nav__link">
    Harbor Container Registry
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protection" class="md-nav__link">
    Protection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-users" class="md-nav__link">
    Test Users
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-workspace-creation" class="md-nav__link">
    User Workspace Creation
  </a>
  
    <nav class="md-nav" aria-label="User Workspace Creation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-workspace-swagger-ui" class="md-nav__link">
    Using Workspace Swagger UI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-curl" class="md-nav__link">
    Using curl
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-create-workspace-helper-script" class="md-nav__link">
    Using create-workspace helper script
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#eoepca-portal" class="md-nav__link">
    EOEPCA Portal
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    Clean-up
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="scripted-deployment">Scripted Deployment<a class="headerlink" href="#scripted-deployment" title="Permanent link">⚓︎</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">⚓︎</a></h2>
<p>The Scripted Deployment provides a demonstration of an example deployment, and can found in the subdirectory <a href="https://github.com/EOEPCA/deployment-guide/blob/eoepca-v1.4/deploy/eoepca/eoepca.sh"><code>deployment-guide/deploy</code></a> of the source repository for this guide&hellip;</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>git clone -b eoepca-v1.4 https://github.com/EOEPCA/deployment-guide <span class="se">\</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="o">&amp;&amp;</span> <span class="nb">cd</span> deployment-guide <span class="se">\</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="o">&amp;&amp;</span> ls deploy
</span></code></pre></div>
<p>The script <a href="https://github.com/EOEPCA/deployment-guide/blob/eoepca-v1.4/deploy/eoepca/eoepca.sh"><code>deploy/eoepca/eoepca.sh</code></a> acts as an entry-point to the full system deployment. In order to tailor the deployment for your target environment, the script is configured through environment variables and command-line arguments. By default the script assumes deployment to a local minikube.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The scripted deployment assumes that installation of the <a href="../../cluster/prerequisite-tooling/">Prerequisite Tooling</a> has been performed.</p>
</div>
<p>The following subsections lead through the steps for a full local deployment. Whilst minikube is assumed, minimal adaptions are required to make the deployment to your existing Kubernetes cluster.</p>
<p>The deployment follows these broad steps:</p>
<ul>
<li><strong>Configuration</strong><br>
  Tailoring of deployment options.</li>
<li><strong>Deployment</strong><br>
  Creation of cluster and deployment of eoepca services.</li>
<li><strong>Manual Steps</strong><br>
  Manual steps to be performed post-deployment.</li>
</ul>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">⚓︎</a></h2>
<p>The script <a href="https://github.com/EOEPCA/deployment-guide/blob/eoepca-v1.4/deploy/eoepca/eoepca.sh"><code>deploy/eoepca/eoepca.sh</code></a> is configured by some environment variables and command-line arguments.</p>
<h3 id="environment-variables">Environment Variables<a class="headerlink" href="#environment-variables" title="Permanent link">⚓︎</a></h3>
<details class="example">
<summary>Environment Variables</summary>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>REQUIRE_&lt;cluster-component></strong></td>
<td>A set of variables that can be used to control which <strong>CLUSTER</strong> components are deployed by the script, as follows (with defaults):<br><code>REQUIRE_MINIKUBE=true</code><br><code>REQUIRE_INGRESS_NGINX=true</code><br><code>REQUIRE_CERT_MANAGER=true</code><br><code>REQUIRE_LETSENCRYPT=true</code><br><code>REQUIRE_SEALED_SECRETS=false</code><br><code>REQUIRE_MINIO=false</code></td>
<td>see description</td>
</tr>
<tr>
<td><strong>REQUIRE_&lt;eoepca-component></strong></td>
<td>A set of variables that can be used to control which <strong><abbr title="EO Exploitation Platform Common Architecture">EOEPCA</abbr></strong> components are deployed by the script, as follows (with defaults):<br><code>REQUIRE_STORAGE=true</code><br><code>REQUIRE_DUMMY_SERVICE=false</code><br><code>REQUIRE_IDENTITY_SERVICE=true</code><br><code>REQUIRE_ADES=true</code><br><code>REQUIRE_RESOURCE_CATALOGUE=true</code><br><code>REQUIRE_DATA_ACCESS=true</code><br><code>REQUIRE_REGISTRATION_API=true</code><br><code>REQUIRE_WORKSPACE_API=true</code><br><code>REQUIRE_HARBOR=true</code><br><code>REQUIRE_PORTAL=true</code><br><code>REQUIRE_APPLICATION_HUB=true</code></td>
<td>see description</td>
</tr>
<tr>
<td><strong>REQUIRE_&lt;protection-component></strong></td>
<td>A set of variables that can be used to control which <strong>PROTECTION</strong> components are deployed by the script, as follows (with defaults):<br><code>REQUIRE_DUMMY_SERVICE_PROTECTION=false</code><br><code>REQUIRE_ADES_PROTECTION=true</code><br><code>REQUIRE_RESOURCE_CATALOGUE_PROTECTION=true</code><br><code>REQUIRE_DATA_ACCESS_PROTECTION=true</code><br><code>REGISTRATION_API_PROTECTION=true</code><br><code>REQUIRE_WORKSPACE_API_PROTECTION=true</code></td>
<td>see description</td>
</tr>
<tr>
<td><strong>MINIKUBE_VERSION</strong></td>
<td>The Minikube version to be (optionally) installed<br>Note that the <abbr title="EO Exploitation Platform Common Architecture">EOEPCA</abbr> development has been conducted using the default stated here.</td>
<td><code>v1.32.0</code></td>
</tr>
<tr>
<td><strong>MINIKUBE_KUBERNETES_VERSION</strong></td>
<td>The Kubernetes version to be used by minikube<br>Note that the <abbr title="EO Exploitation Platform Common Architecture">EOEPCA</abbr> development has been conducted primarily using version 1.22.5.</td>
<td><code>v1.22.5</code></td>
</tr>
<tr>
<td><strong>MINIKUBE_MEMORY_AMOUNT</strong></td>
<td>Amount of memory to allocate to the docker containers used by minikube to implement the cluster.</td>
<td><code>12g</code></td>
</tr>
<tr>
<td><strong>MINIKUBE_DISK_AMOUNT</strong></td>
<td>Amount of disk space to allocate to the docker containers used by minikube to implement the cluster.</td>
<td><code>20g</code></td>
</tr>
<tr>
<td><strong>MINIKUBE_EXTRA_OPTIONS</strong></td>
<td>Additional options to pass to <code>minikube start</code> command-line</td>
<td><code>--ports=80:80,443:443</code></td>
</tr>
<tr>
<td><strong>USE_METALLB</strong></td>
<td>Enable use of minikube&rsquo;s built-in load-balancer.<br>The load-balancer can be used to facilitate exposing services publicly. However, the same can be achieved using minikube&rsquo;s built-in ingress-controller. Therefore, this option is suppressed by default.</td>
<td><code>false</code></td>
</tr>
<tr>
<td><strong>USE_INGRESS_NGINX_HELM</strong></td>
<td>Install the ingress-nginx controller using the published helm chart, rather than relying upon the version that is built-in to minikube. By default we prefer the version that is built in to minikube.</td>
<td><code>false</code></td>
</tr>
<tr>
<td><strong>USE_INGRESS_NGINX_LOADBALANCER</strong></td>
<td>Patch the built-in minikube nginx-ingress-controller to offer a service of type <code>LoadBalancer</code>, rather than the default <code>NodePort</code>. It was initially thought that this would be necessary to achieve public access to the ingress services - but was subsequently found that the default <code>NodePort</code> configuration of the ingress-controller was sufficient. This option is left in case it proves useful.<br>Only applicable for <code>USE_INGRESS_NGINX_HELM=false</code> (i.e. when using the minikube built-in )</td>
<td><code>false</code></td>
</tr>
<tr>
<td><strong>OPEN_INGRESS</strong></td>
<td>Create &lsquo;open&rsquo; ingress endpoints that are not subject to authorization protection. For a secure system the open endpoints should be disabled (<code>false</code>) and access to resource should be protected via <a href="../../eoepca/resource-protection-keycloak/">ingress that apply protection</a></td>
<td><code>false</code></td>
</tr>
<tr>
<td><strong>USE_TLS</strong></td>
<td>Indicates whether TLS will be configured for service <code>Ingress</code> rules.<br>If not (i.e. <code>USE_TLS=false</code>), then the ingress-controller is configured to disable <code>ssl-redirect</code>, and <code>TLS_CLUSTER_ISSUER=notls</code> is set.</td>
<td><code>true</code></td>
</tr>
<tr>
<td><strong>TLS_CLUSTER_ISSUER</strong></td>
<td>The name of the ClusterIssuer to satisfy ingress tls certificates.<br>Out-of-the-box <em>ClusterIssuer</em> instances are configured in the file <code>deploy/cluster/letsencrypt.sh</code>.</td>
<td><code>letsencrypt-staging</code></td>
</tr>
<tr>
<td><strong>IDENTITY_SERVICE_DEFAULT_SECRET</strong></td>
<td>Default secret that is used by exception for other Identity Service credentials</td>
<td><code>changeme</code></td>
</tr>
<tr>
<td><strong>IDENTITY_SERVICE_ADMIN_USER</strong></td>
<td>The admin user for Keycloak</td>
<td><code>admin</code></td>
</tr>
<tr>
<td><strong>IDENTITY_SERVICE_ADMIN_PASSWORD</strong></td>
<td>The admin user password for Keycloak</td>
<td><code>${IDENTITY_SERVICE_DEFAULT_SECRET}</code></td>
</tr>
<tr>
<td><strong>IDENTITY_SERVICE_ADMIN_CLIENT</strong></td>
<td>The Keycloak client to use for admin API tasks during scripted deployment</td>
<td><code>admin-cli</code></td>
</tr>
<tr>
<td><strong>IDENTITY_POSTGRES_PASSWORD</strong></td>
<td>The password for the Keycloak Postgres service</td>
<td><code>${IDENTITY_SERVICE_DEFAULT_SECRET}</code></td>
</tr>
<tr>
<td><strong>IDENTITY_GATEKEEPER_CLIENT_SECRET</strong></td>
<td>The secret used for each Keycloak client (one per resource service) created during scripted deployment</td>
<td><code>${IDENTITY_SERVICE_DEFAULT_SECRET}</code></td>
</tr>
<tr>
<td><strong>IDENTITY_GATEKEEPER_ENCRYPTION_KEY</strong></td>
<td>The encryption key for each Keycloak client (one per resource service) created during scripted deployment</td>
<td><code>changemechangeme</code></td>
</tr>
<tr>
<td><strong>IDENTITY_REALM</strong></td>
<td>Keycloak realm for Identity Service.<br><em>This is not explicitly created by the scripted deployment, and so is assumed to exist within the Keycloak instance. Thus, will probably break the deployment if modified.</em></td>
<td><code>master</code></td>
</tr>
<tr>
<td><strong>MINIO_ROOT_USER</strong></td>
<td>Name of the &lsquo;root&rsquo; user for the Minio object storage service.</td>
<td><code>eoepca</code></td>
</tr>
<tr>
<td><strong>MINIO_ROOT_PASSWORD</strong></td>
<td>Password for the &lsquo;root&rsquo; user for the Minio object storage service.</td>
<td><code>changeme</code></td>
</tr>
<tr>
<td><strong>HARBOR_ADMIN_PASSWORD</strong></td>
<td>Password for the &lsquo;admin&rsquo; user for the Harbor artefact registry service.</td>
<td><code>changeme</code></td>
</tr>
<tr>
<td><strong>DEFAULT_STORAGE</strong></td>
<td><em>Storage Class</em> to be used by default for all components requiring dynamic storage provisioning.<br>See variables <code>&lt;component&gt;_STORAGE</code> for per-component overrides.</td>
<td><code>standard</code></td>
</tr>
<tr>
<td><strong>&lt;component>_STORAGE</strong></td>
<td>A set of variables to control the dynamic provisioning <em>Storage Class</em> for individual components, as follows:<br>MINIO_STORAGE<br>ADES_STORAGE<br>APPLICATION_HUB_STORAGE<br>DATA_ACCESS_STORAGE<br>HARBOR_STORAGE<br>RESOURCE_CATALOGUE_STORAGE</td>
<td><code>&lt;DEFAULT_STORAGE&gt;</code></td>
</tr>
<tr>
<td><strong>PROCESSING_MAX_RAM</strong></td>
<td>Max RAM allocated to an individual processing job</td>
<td><code>8Gi</code></td>
</tr>
<tr>
<td><strong>PROCESSING_MAX_CORES</strong></td>
<td>Max number of CPU cores allocated to an individual processing job</td>
<td><code>4</code></td>
</tr>
<tr>
<td><strong>PROCESSING_ZOO_IMAGE</strong></td>
<td>Container image for <code>zoo-dru</code> deployment</td>
<td><code>eoepca-092ea7a2c6823dba9c6d52c383a73f5ff92d0762</code></td>
</tr>
<tr>
<td><strong>STAGEOUT_TARGET</strong></td>
<td>Configures the ADES with the destination to which it should push processing results:<br><code>workspace</code> - via the Workspace API<br><code>minio</code> - to minio S3 object storage</td>
<td><code>workspace</code></td>
</tr>
<tr>
<td><strong>INSTALL_FLUX</strong></td>
<td>The Workspace API relies upon <a href="https://fluxcd.io/">Flux CI/CD</a>, and has the capability to install the required flux components to the cluster. If your deployment already has flux installed then set this value <code>false</code> to suppress the Workspace API flux install</td>
<td><code>true</code></td>
</tr>
<tr>
<td><strong>CREODIAS_DATA_SPECIFICATION</strong></td>
<td>Apply the data specification to harvest from the CREODIAS data offering into the resource-catalogue and data-access services.<br><em>Can only be used when running in the CREODIAS (Cloudferro) cloud, with access to the <code>eodata</code> network.</em></td>
<td><code>false</code></td>
</tr>
<tr>
<td><strong>TEMP_FORWARDING_PORT</strong></td>
<td>Local port used during the scripted deployment for <code>kubectl port-forward</code> operations</td>
<td><code>9876</code></td>
</tr>
</tbody>
</table>
</details>
<h3 id="command-line-arguments">Command-line Arguments<a class="headerlink" href="#command-line-arguments" title="Permanent link">⚓︎</a></h3>
<p>The eoepca.sh script is further configured via command-line arguments&hellip;</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>eoepca.sh &lt;action&gt; &lt;cluster-name&gt; &lt;domain&gt; &lt;public-ip&gt;
</span></code></pre></div>
<details class="example">
<summary><code>eoepca.sh</code> Command-line Arguments</summary>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>action</strong></td>
<td>Action to perform: <code>apply</code> | <code>delete</code> | <code>template</code>.<br><code>apply</code> makes the deployment<br><code>delete</code> removes the deployment<br><code>template</code> outputs generated kubernetes yaml to stdout</td>
<td><code>apply</code></td>
</tr>
<tr>
<td><strong>cluster-name</strong></td>
<td>The name of the minikube &lsquo;profile&rsquo; for the created minikube cluster</td>
<td><code>eoepca</code></td>
</tr>
<tr>
<td><strong>domain</strong></td>
<td>The DNS domain name through which the deployment is accessed. Forms the stem for all service hostnames in the ingress rules - i.e. <code>&lt;service-name&gt;.&lt;domain&gt;</code>.<br>By default, the value is deduced from the assigned cluster minikube IP address, using <code>nip.io</code> to establish a DNS lookup - i.e. <code>&lt;minikube ip&gt;.nip.io</code>.</td>
<td><code>&lt;minikube ip&gt;.nip.io</code></td>
</tr>
<tr>
<td><strong>public-ip</strong></td>
<td>The public IP address through which the deployment is exposed via the ingress-controller.<br>By default, the value is deduced from the assigned cluster minikube IP address - ref. command <code>minikube ip</code>.</td>
<td><code>&lt;minikube-ip&gt;</code></td>
</tr>
</tbody>
</table>
</details>
<h3 id="public-deployment">Public Deployment<a class="headerlink" href="#public-deployment" title="Permanent link">⚓︎</a></h3>
<p>For simplicity, the out-of-the-box scripts assume a &lsquo;private&rsquo; deployment - with no public IP / DNS and hence no use of TLS for service ingress endpoints.</p>
<p>In the case that an external-facing public deployment is desired, then the following configuration selections should be made:</p>
<ul>
<li><code>domain</code> - set to the domain (as per DNS records) for your deployment<br>
  <em>Note that the <abbr title="EO Exploitation Platform Common Architecture">EOEPCA</abbr> components typically configure their ingress with hostname prefixes applied to this <code>domain</code>. Thus, it is necessary that the DNS record for the domain is established as a wildcard record - i.e. <code>*.&lt;domain&gt;</code></em></li>
<li><code>public_ip</code> - set to the public IP address through which the deployment is exposed via the ingress-controller<br>
  <em>i.e. the IP address that is assigned to the ingress controller service of type LoadBalancer</em></li>
<li><code>USE_TLS=true</code> - to enable configuration of TLS endpoints in each component service ingress</li>
<li><code>TLS_CLUSTER_ISSUER=&lt;issuer&gt;</code> - should be configured ~ e.g. using the <code>letsencrypt-production</code> or <code>letsencrypt-staging</code> (testing only) <em>Cluster Issuer</em> that are configured by the scripted deployment</li>
</ul>
<h2 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">⚓︎</a></h2>
<p>The deployment is initiated by setting the appropriate <a href="#environment-variables">environment variables</a> and invoking the <code>eoepca.sh</code> script with suitable <a href="#command-line-arguments">command-line arguments</a>. You may find it convenient to do so using a wrapper script that customises the environment varaibles according to your cluster, and then invokes the <code>eoepca.sh</code> script.</p>
<p>Customised examples are provided for Simple, CREODIAS and Processing deployments.</p>
<p><strong><em>NOTE that if a prior deployment has been attempted then, before redeploying, a clean-up should be performed as described in the <a href="#clean-up">Clean-up</a> section below. This is particularly important in the case that the minikube <code>none</code> driver is used, as the persistence is maintained on the host and so is not naturally removed when the minikube cluster is destroyed.</em></strong></p>
<p>Initiate the deployment&hellip;
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>./deploy/eoepca/eoepca.sh apply <span class="s2">&quot;&lt;cluster-name&gt;&quot;</span> <span class="s2">&quot;&lt;public-ip&gt;&quot;</span> <span class="s2">&quot;&lt;domain&gt;&quot;</span>
</span></code></pre></div></p>
<p>The deployment takes 10+ minutes - depending on the resources of your host/cluster. The progress can be monitored&hellip;
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>kubectl get pods -A
</span></code></pre></div></p>
<p>The deployment is ready once all pods are either <code>Running</code> or <code>Completed</code>.</p>
<h2 id="post-deployment-manual-steps">Post-deployment Manual Steps<a class="headerlink" href="#post-deployment-manual-steps" title="Permanent link">⚓︎</a></h2>
<p>The scripted deployment has been designed, as far as possible, to automate the configuration of the deployed components. However, there remain some steps that must be performed manually after the scripted deployment has completed.<br>
See the building block specific pages&hellip;</p>
<ul>
<li><strong>Identity Service:</strong> <a href="../../eoepca/identity-service/#token-lifespans">Token Lifespans</a></li>
<li><strong>Application Hub:</strong> <a href="../../eoepca/application-hub/#post-deployment-manual-steps">Post-deployment Manual Steps</a></li>
</ul>
<h2 id="default-credentials">Default Credentials<a class="headerlink" href="#default-credentials" title="Permanent link">⚓︎</a></h2>
<h3 id="identity-service">Identity Service<a class="headerlink" href="#identity-service" title="Permanent link">⚓︎</a></h3>
<p>By default, the Identity Service is accessed at the URL <code>https://keycloak.192-168-49-2.nip.io/</code> with the credentials&hellip;</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>username: `admin`
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>password: `changeme`
</span></code></pre></div>
<p>&hellip;unless the password is overridden via the variable <code>IDENTITY_SERVICE_ADMIN_PASSWORD</code>.</p>
<h3 id="minio-object-storage">Minio Object Storage<a class="headerlink" href="#minio-object-storage" title="Permanent link">⚓︎</a></h3>
<p>By default, Minio is accessed at the URL <code>https://console.minio.192-168-49-2.nip.io/</code> with the credentials&hellip;</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>username: `eoepca`
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>password: `changeme`
</span></code></pre></div>
<p>&hellip;unless the username/password are overridden via the variables <code>MINIO_ROOT_USER</code> and <code>MINIO_ROOT_PASSWORD</code>.</p>
<h3 id="harbor-container-registry">Harbor Container Registry<a class="headerlink" href="#harbor-container-registry" title="Permanent link">⚓︎</a></h3>
<p>By default, Harbor is accessed at the URL <code>https://harbor.192-168-49-2.nip.io/</code> with the credentials&hellip;</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>username: `admin`
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>password: `changeme`
</span></code></pre></div>
<p>&hellip;unless the password is overridden via the variable <code>HARBOR_ADMIN_PASSWORD</code>.</p>
<h2 id="protection">Protection<a class="headerlink" href="#protection" title="Permanent link">⚓︎</a></h2>
<p>The protection of resource server endpoints is applied during the deployment of each service requiring protection. This comprises creating a dedicated Keycloak client for each resource server, and the creation of associated resources and policies that protect the service-specific URLs.</p>
<p>This protection can be disabled via the environment variables <code>REQUIRE_XXX_PROTECTION</code> - e.g. <code>REQUIRE_ADES_PROTECTION=false</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, if <code>OPEN_INGRESS</code> is set <code>true</code> then <code>PROTECTION</code> will be disabled (<code>false</code>) unless overridden via the <code>REQUIRE_XXX_PROTECTION</code> variables.</p>
</div>
<h2 id="test-users">Test Users<a class="headerlink" href="#test-users" title="Permanent link">⚓︎</a></h2>
<p>The deployment creates (in the Keycloak Identity Service) the test users: <code>eric</code>, <code>bob</code>, <code>alice</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This does NOT create the workspace for each of these users - which must be performed via the Workspace API.</p>
</div>
<h2 id="user-workspace-creation">User Workspace Creation<a class="headerlink" href="#user-workspace-creation" title="Permanent link">⚓︎</a></h2>
<p>The deployment created the test users <code>eric</code>, <code>bob</code> and <code>alice</code>. For completeness we use the Workspace API to create their user workspaces, which hold their personal resources (data, processing results, etc.) within the platform - see <a href="../../eoepca/workspace/">Workspace</a>.</p>
<h3 id="using-workspace-swagger-ui">Using Workspace Swagger UI<a class="headerlink" href="#using-workspace-swagger-ui" title="Permanent link">⚓︎</a></h3>
<p>The Workspace API provides a Swagger UI that facilitates interaction with the API - at the URL <code>https://workspace-api.192-168-49-2.nip.io/docs#</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the Workspace API has been protected (<a href="../../eoepca/identity-service/#protection-of-resources">via Gatekeeper with Keycloak</a>), then requests must be supported by an <code>access_token</code> carried in the HTTP header <code>Authorozation: Bearer &lt;token&gt;</code>. This diminishes the utility of the swagger UI.</p>
</div>
<p>Access the Workspace Swagger UI at <code>https://workspace-api.192-168-49-2.nip.io/docs</code>. Workspaces are created using <code>POST  /workspaces</code> <strong>(Create Workspace)</strong>. Expand the node and select <code>Try it out</code>. Complete the request body, such as&hellip;
<div class="language-json highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="p">{</span><span class="w"></span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">  </span><span class="nt">&quot;preferred_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eric&quot;</span><span class="p">,</span><span class="w"></span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">  </span><span class="nt">&quot;default_owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eric&quot;</span><span class="w"></span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="p">}</span><span class="w"></span>
</span></code></pre></div>
&hellip;where the <code>default_owner</code> is the ID for the user in Keycloak - thus protecting the created workspace for the identified user.</p>
<h3 id="using-curl">Using <code>curl</code><a class="headerlink" href="#using-curl" title="Permanent link">⚓︎</a></h3>
<p>The same can be achieved with a straight http request, for example using <code>curl</code>&hellip;</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>curl -X <span class="s1">&#39;POST&#39;</span> <span class="se">\</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>  <span class="s1">&#39;http://workspace-api.192-168-49-2.nip.io/workspaces&#39;</span> <span class="se">\</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>  -H <span class="s1">&#39;Content-Type: application/json&#39;</span> <span class="se">\</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>  -H <span class="s1">&#39;Accept: application/json&#39;</span> <span class="se">\</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>  -H <span class="s1">&#39;Authorization: Bearer &lt;admin-access-token&gt;&#39;</span> <span class="se">\</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>  -d <span class="s1">&#39;{</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="s1">  &quot;preferred_name&quot;: &quot;&lt;workspace-name&gt;&quot;,</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="s1">  &quot;default_owner&quot;: &quot;&lt;user-id&gt;&quot;</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="s1">}&#39;</span>
</span></code></pre></div>
<p>Values must be provided for:</p>
<ul>
<li><code>admin-access-token</code> - Access Token for the admin user</li>
<li><code>workspace-name</code> - name of the workspace, typically the username</li>
<li><code>user-id</code> - the ID of the user for which the created workspace will be protected, typically the username</li>
</ul>
<p>The Access Token for the <code>admin</code> user can be obtained with a call to the token endpoint of the Identity Service - supplying the credentials for the <code>admin</code> user and the pre-registered client&hellip;</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>curl -L -X POST <span class="s1">&#39;https://keycloak.192-168-49-2.nip.io/realms/master/protocol/openid-connect/token&#39;</span> <span class="se">\</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>  -H <span class="s1">&#39;Cache-Control: no-cache&#39;</span> <span class="se">\</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>  -H <span class="s1">&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> <span class="se">\</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>  --data-urlencode <span class="s1">&#39;scope=openid profile email&#39;</span> <span class="se">\</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>  --data-urlencode <span class="s1">&#39;grant_type=password&#39;</span> <span class="se">\</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>  --data-urlencode <span class="s1">&#39;username=admin&#39;</span> <span class="se">\</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>  --data-urlencode <span class="s1">&#39;password=&lt;admin-password&gt;&#39;</span> <span class="se">\</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>  --data-urlencode <span class="s1">&#39;client_id=admin-cli&#39;</span>
</span></code></pre></div>
<p>A json response is returned, in which the field <code>access_token</code> provides the Access Token for the <code>admin</code> user.</p>
<h3 id="using-create-workspace-helper-script">Using <code>create-workspace</code> helper script<a class="headerlink" href="#using-create-workspace-helper-script" title="Permanent link">⚓︎</a></h3>
<p>As an aide there is a helper script <a href="https://github.com/EOEPCA/deployment-guide/blob/eoepca-v1.4/deploy/bin/create-workspace"><code>create-workspace</code></a>. The script is available in the <a href="https://github.com/EOEPCA/deployment-guide"><code>deployment-guide</code> repository</a>, and can be obtained as follows&hellip;</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>git clone -b eoepca-v1.4 git@github.com:EOEPCA/deployment-guide
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="nb">cd</span> deployment-guide
</span></code></pre></div>
<p>The <code>create-workspace</code> helper script requires some command-line arguments&hellip;</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>$ ./deploy/bin/create-workspace -h
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>Create a new User Workspace.
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>create-workspace -h | -w {workspace_api} -a {auth_server} -r {realm} -c {client} -u {admin-username} -p {admin-password} -O {owner} -W {workspace-name}
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>where:
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>    -h  show help message
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>    -w  workspace-api service url (default: http://workspace-api.192-168-49-2.nip.io)
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>    -a  authorization server url (default: http://keycloak.192-168-49-2.nip.io)
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>    -r  realm within Keycloak (default: master)
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>    -u  username used for authentication (default: admin)
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>    -p  password used for authentication (default: changeme)
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>    -c  client id of the bootstrap client used in the create request (default: admin-cli)
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>    -O  user ID of the &#39;owner&#39; of the new workspace (default: workspace(-W))
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>    -W  name of the workspace to create (default: owner(-O))
</span></code></pre></div>
<p>Most of the arguments have default values that are aligned to the defaults of the scripted deployment.<br>
At minimum either <code>-O owner</code> or <code>-W workspace</code> must be specified.</p>
<p>For example (assuming defaults)&hellip;</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>./deploy/bin/create-workspace -O eric
</span></code></pre></div>
<p>For example (all arguments)&hellip;</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>./deploy/bin/create-workspace 
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>  -w http://workspace-api.192-168-49-2.nip.io <span class="se">\</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>  -a http://keycloak.192-168-49-2.nip.io <span class="se">\</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>  -r master <span class="se">\</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>  -u admin <span class="se">\</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>  -p changeme <span class="se">\</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>  -c admin-cli <span class="se">\</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>  -O bob <span class="se">\</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>  -W bob
</span></code></pre></div>
<h2 id="eoepca-portal"><abbr title="EO Exploitation Platform Common Architecture">EOEPCA</abbr> Portal<a class="headerlink" href="#eoepca-portal" title="Permanent link">⚓︎</a></h2>
<p>The <code>eoepca-portal</code> is a simple web application that is used as a test aid. It&rsquo;s main purpose is to provide the ability to login, and so establish a session with appropriate browser cookies - which then allow authenticated access to other <abbr title="EO Exploitation Platform Common Architecture">EOEPCA</abbr> services such as the Workspace API, Identity API, etc.</p>
<p>The portal is deployed via a helm chart&hellip;</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>helm install eoepca-portal eoepca-portal -f portal-values.yaml - <span class="se">\</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>  --repo https://eoepca.github.io/helm-charts <span class="se">\</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>  --namespace <span class="s2">&quot;demo&quot;</span> --create-namespace <span class="se">\</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>  --version <span class="m">1</span>.0.11
</span></code></pre></div>
<p>The helm values must be tailored for your deployment.<br>
For example&hellip;</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nt">configMap</span><span class="p">:</span><span class="w"></span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">  </span><span class="nt">identity_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://keycloak.192-168-49-2.nip.io&quot;</span><span class="w"></span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">  </span><span class="nt">realm</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;master&quot;</span><span class="w"></span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">  </span><span class="nt">client_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eoepca-portal&quot;</span><span class="w"></span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">  </span><span class="nt">identity_api_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://identity-api.192-168-49-2.nip.io&quot;</span><span class="w"></span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">  </span><span class="nt">ades_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://zoo.192-168-49-2.nip.io/ogc-api/processes&quot;</span><span class="w"></span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">  </span><span class="nt">resource_catalogue_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://resource-catalogue.192-168-49-2.nip.io&quot;</span><span class="w"></span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">  </span><span class="nt">data_access_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://data-access.192-168-49-2.nip.io&quot;</span><span class="w"></span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">  </span><span class="nt">workspace_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://workspace-api.192-168-49-2.nip.io&quot;</span><span class="w"></span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">  </span><span class="nt">workspace_docs_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://workspace-api.192-168-49-2.nip.io/docs#&quot;</span><span class="w"></span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w">  </span><span class="nt">images_registry_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://harbor.192-168-49-2.nip.io&quot;</span><span class="w"></span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">  </span><span class="nt">dummy_service_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://dummy-service.192-168-49-2.nip.io&quot;</span><span class="w"></span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w">  </span><span class="nt">access_token_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;auth_user_id&quot;</span><span class="w"></span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w">  </span><span class="nt">access_token_domain</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;.192-168-49-2.nip.io&quot;</span><span class="w"></span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w">  </span><span class="nt">refresh_token_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;auth_refresh_token&quot;</span><span class="w"></span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="w">  </span><span class="nt">refresh_token_domain</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;.192-168-49-2.nip.io&quot;</span><span class="w"></span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="nt">ingress</span><span class="p">:</span><span class="w"></span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w"></span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w">    </span><span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span><span class="w"></span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">    </span><span class="nt">ingress.kubernetes.io/ssl-redirect</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="w"></span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/ssl-redirect</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="w"></span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w">    </span><span class="nt">cert-manager.io/cluster-issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-production</span><span class="w"></span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"></span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eoepca-portal.192-168-49-2.nip.io</span><span class="w"></span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="w">      </span><span class="nt">paths</span><span class="p">:</span><span class="w"></span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span><span class="w"></span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="w">          </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span><span class="w"></span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="w">  </span><span class="nt">tls</span><span class="p">:</span><span class="w"></span>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eoepca-portal-tls</span><span class="w"></span>
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="w">      </span><span class="nt">hosts</span><span class="p">:</span><span class="w"></span>
</span><span id="__span-15-32"><a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eoepca-portal.192-168-49-2.nip.io</span><span class="w"></span>
</span></code></pre></div>
<p>The setting <code>client_id: eoepca-portal</code> identifies a client that must be created in Keycloak - as described in section <a href="../../eoepca/identity-service/#create-client-helper-script"><code>create-client</code> Helper Script</a> - noting that the <code>eoepca-portal</code> requires a client that is configured as a <code>Public Client</code>&hellip;</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>../bin/create-client <span class="se">\</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>  -a https://keycloak.192-168-49-2.nip.io <span class="se">\</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>  -i https://identity-api.192-168-49-2.nip.io <span class="se">\</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>  -r <span class="s2">&quot;master&quot;</span> <span class="se">\</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>  -u <span class="s2">&quot;admin&quot;</span> <span class="se">\</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>  -p <span class="s2">&quot;changeme&quot;</span> <span class="se">\</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>  -c <span class="s2">&quot;admin-cli&quot;</span> <span class="se">\</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>  --id<span class="o">=</span>eoepca-portal <span class="se">\</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>  --name<span class="o">=</span><span class="s2">&quot;EOEPCA Portal&quot;</span> <span class="se">\</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>  --public <span class="se">\</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>  --description<span class="o">=</span><span class="s2">&quot;Client to be used by the EOEPCA Portal&quot;</span>
</span></code></pre></div>
<h2 id="clean-up">Clean-up<a class="headerlink" href="#clean-up" title="Permanent link">⚓︎</a></h2>
<p>Before initiating a fresh deployment, if a prior deployment has been attempted, then it is necessary to remove any persistent artefacts of the prior deployment. This includes&hellip;</p>
<ol>
<li>
<p><strong>Minikube cluster</strong><br>
  Delete the minikube cluster&hellip;<br>
  <code>minikube delete</code><br>
  If necessary specify the cluster (profile)&hellip;<br>
  <code>minikube -p &lt;profile&gt; delete</code><br></p>
</li>
<li>
<p><strong>Persistent Data</strong><br>
  In the case that the minikube <code>none</code> driver is used, the persistence is maintained on the host and so is not naturally removed when the minikube cluster is destroyed. In this case, the minikube <code>standard</code> <em>StorageClass</em> is fulfilled by the <code>hostpath</code> provisioner, whose persistence is removed as follows&hellip;<br>
  <code>sudo rm -rf /tmp/hostpath-provisioner</code></p>
</li>
</ol>
<p>There is a helper script <a href="https://github.com/EOEPCA/deployment-guide/blob/eoepca-v1.4/deploy/cluster/clean"><code>clean</code></a> that can be used for step 2 above, (the script does not delete the cluster).
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>./deploy/cluster/clean
</span></code></pre></div></p>

              
            </article>
            
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../quickstart/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Quick Start" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Quick Start
            </div>
          </div>
        </a>
      
      
        
        <a href="../simple-deployment/" class="md-footer__link md-footer__link--next" aria-label="Next: Simple" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Simple
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top", "content.code.copy"], "search": "../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.0238f547.min.js"></script>
      
    
  </body>
</html>