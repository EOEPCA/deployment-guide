
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://deployment-guide.docs.eoepca.org/current/eoepca/workspace/">
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.8">
    
    
      
        <title>Workspace - EOEPCA Deployment Guide</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#workspace" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../../..">
    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          
        </aside>
      </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="EOEPCA Deployment Guide" class="md-header__button md-logo" aria-label="EOEPCA Deployment Guide" data-md-component="logo">
      
  <img src="../../img/favicon.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EOEPCA Deployment Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Workspace
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/EOEPCA/deployment-guide" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link md-tabs__link--active">
        Deployment Guide
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="EOEPCA Deployment Guide" class="md-nav__button md-logo" aria-label="EOEPCA Deployment Guide" data-md-component="logo">
      
  <img src="../../img/favicon.ico" alt="logo">

    </a>
    EOEPCA Deployment Guide
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/EOEPCA/deployment-guide" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Deployment Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deployment Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Deployment Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2" type="checkbox" id="__nav_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_2">
          Quick Start
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Quick Start" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          Quick Start
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/quickstart/" class="md-nav__link">
        Quick Start
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/scripted-deployment/" class="md-nav__link">
        Scripted Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/simple-deployment/" class="md-nav__link">
        Simple Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/processing-deployment/" class="md-nav__link">
        Processing Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/data-access-deployment/" class="md-nav__link">
        Data Access
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/exploitation-deployment/" class="md-nav__link">
        Exploitation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/userman-deployment/" class="md-nav__link">
        User Management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/creodias-deployment/" class="md-nav__link">
        CREODIAS Deployment
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_3" type="checkbox" id="__nav_1_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_3">
          Cluster
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Cluster" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          Cluster
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/prerequisite-tooling/" class="md-nav__link">
        Prerequisite Tooling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/kubernetes/" class="md-nav__link">
        Kubernetes Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/helm-repositories/" class="md-nav__link">
        Helm Repositories
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/cluster-prerequisites/" class="md-nav__link">
        Cluster Prerequisites
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_4" type="checkbox" id="__nav_1_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1_4">
          EOEPCA
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="EOEPCA" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_4">
          <span class="md-nav__icon md-icon"></span>
          EOEPCA
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../persistence/" class="md-nav__link">
        Persistence
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../login-service/" class="md-nav__link">
        Login Service
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user-profile/" class="md-nav__link">
        User Profile
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pdp/" class="md-nav__link">
        Policy Decision Point
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../resource-protection/" class="md-nav__link">
        Resource Protection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ades/" class="md-nav__link">
        Application Deployment & Execution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../resource-catalogue/" class="md-nav__link">
        Resource Catalogue
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data-access/" class="md-nav__link">
        Data Access
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Workspace
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Workspace
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#workspace-api" class="md-nav__link">
    Workspace API
  </a>
  
    <nav class="md-nav" aria-label="Workspace API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#helm-chart" class="md-nav__link">
    Helm Chart
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#values" class="md-nav__link">
    Values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flux-dependency" class="md-nav__link">
    Flux Dependency
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-workspace-templates" class="md-nav__link">
    User Workspace Templates
  </a>
  
    <nav class="md-nav" aria-label="User Workspace Templates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#templates-configmap" class="md-nav__link">
    Templates ConfigMap
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helmrepositories-for-templates" class="md-nav__link">
    HelmRepositories for Templates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helm-template-parameters" class="md-nav__link">
    Helm Template Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#protection" class="md-nav__link">
    Protection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-secret" class="md-nav__link">
    Client Secret
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workspace-api-usage" class="md-nav__link">
    Workspace API Usage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-information" class="md-nav__link">
    Additional Information
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bucket-operator" class="md-nav__link">
    Bucket Operator
  </a>
  
    <nav class="md-nav" aria-label="Bucket Operator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#values_1" class="md-nav__link">
    Values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openstack-secret" class="md-nav__link">
    OpenStack Secret
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../container-registry/" class="md-nav__link">
        Container Registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pde/" class="md-nav__link">
        Processor Development Environment
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="workspace">Workspace<a class="headerlink" href="#workspace" title="Permanent link">⚓︎</a></h1>
<p>The <em>Workspace</em> provides protected user resource management that includes dedicated storage and services for resource discovery and access.</p>
<h2 id="workspace-api">Workspace API<a class="headerlink" href="#workspace-api" title="Permanent link">⚓︎</a></h2>
<p>The <em>Workspace API</em> provides a REST service through which user workspaces can be created, interrogated, managed and deleted.</p>
<h3 id="helm-chart">Helm Chart<a class="headerlink" href="#helm-chart" title="Permanent link">⚓︎</a></h3>
<p>The <em>Workspace API</em> is deployed via the <code>rm-workspace-api</code> helm chart from the <a href="https://eoepca.github.io/helm-charts">EOEPCA Helm Chart Repository</a>.</p>
<p>The chart is configured via values that are fully documented in the <a href="https://github.com/EOEPCA/helm-charts/tree/main/charts/rm-workspace-api#readme">README for the <code>um-workspace-api</code> chart</a>.</p>
<pre><code class="language-bash">helm install --version 1.2.0 --values workspace-api-values.yaml workspace-api eoepca/rm-workspace-api
</code></pre>
<h3 id="values">Values<a class="headerlink" href="#values" title="Permanent link">⚓︎</a></h3>
<p>At minimum, values for the following attributes should be specified:</p>
<ul>
<li>The fully-qualified public URL for the service</li>
<li>(optional) Specification of Ingress for reverse-proxy access to the service<br>
  <em>Note that this is only required in the case that the Workspace API will <strong>not</strong> be protected by the <code>resource-guard</code> component - ref. <a href="../resource-protection">Resource Protection</a>. Otherwise the ingress will be handled by the <code>resource-guard</code> - use <code>ingress.enabled: false</code>.</em></li>
<li>Prefix for user projects in OpenStack</li>
<li>Details for underlying S3 object storage service</li>
<li>Identification of secret that provides the client credentials for resource protection</li>
<li>Whether flux components should be installed - otherwise they must already be present - <a href="#flux-dependency">Flux Dependency</a></li>
<li>Name of the ConfigMap for user workspace templates - See <a href="#user-workspace-templates">User Workspace Templates</a></li>
</ul>
<p>Example <code>workspace-api-values.yaml</code>&hellip;</p>
<pre><code class="language-yaml">fullnameOverride: workspace-api
ingress:
  enabled: true
  hosts:
    - host: workspace-api-open.192.168.49.2.nip.io
      paths: [&quot;/&quot;]
  tls:
    - hosts:
        - workspace-api-open.192.168.49.2.nip.io
      secretName: workspace-api-open-tls
fluxHelmOperator:
  enabled: true
prefixForName: &quot;guide-user&quot;
workspaceSecretName: &quot;bucket&quot;
namespaceForBucketResource: &quot;rm&quot;
s3Endpoint: &quot;https://cf2.cloudferro.com:8080&quot;
s3Region: &quot;RegionOne&quot;
harborUrl: &quot;https://harbor.192.168.49.2.nip.io&quot;
harborUsername: &quot;admin&quot;
harborPassword: &quot;changeme&quot;
umaClientSecretName: &quot;resman-client&quot;
umaClientSecretNamespace: &quot;rm&quot;
workspaceChartsConfigMap: &quot;workspace-charts&quot;
</code></pre>
<p><strong>NOTES:</strong></p>
<ul>
<li>The Workspace API assumes a deployment of the Harbor Container Regsitry, as configured by the <code>harborXXX</code> values above.<br>See section <a href="../container-registry/">Container Registry</a>.</li>
</ul>
<h3 id="flux-dependency">Flux Dependency<a class="headerlink" href="#flux-dependency" title="Permanent link">⚓︎</a></h3>
<p>Workspaces are created by instantiating the <a href="https://github.com/EOEPCA/helm-charts/tree/main/charts/rm-user-workspace"><code>rm-user-workspace</code> helm chart</a> for each user/group. The Workspace API uses <a href="https://fluxcd.io/">Flux CD</a> as a helper to manage these subordinate helm charts - via flux resources of type <code>HelmRelease</code>. Thus, it is necessary to deploy within the cluster the aspects of flux that support this helm chart management - namely the flux <code>helm-controller</code>, <code>source-controller</code> and the Kubernetes <em>Custom Resource Definitions (CRD)</em> for <code>HelmRelease</code> and <code>HelmRepository</code>.</p>
<p>In case you are not already using flux within your clsuter, then the Workspace API helm chart can be configured to deploy the required flux components&hellip;</p>
<pre><code>fluxHelmOperator:
  enabled: true  # true = install flux for me, false = I already have flux
</code></pre>
<h3 id="user-workspace-templates">User Workspace Templates<a class="headerlink" href="#user-workspace-templates" title="Permanent link">⚓︎</a></h3>
<p>The Workspace API instantiates for each user a set of services, including a Resource Catalogue and Data Access services. These user services are instantiated via helm using templates. The templates are provided to the Workspace API in a <code>ConfigMap</code> that is, by default, named <code>workspace-charts</code>. Each file in the config-map is expected to be of <code>kind</code> <code>HelmRelease</code>. During creation of a new workspace, the Worksapce API applies each file to the cluster in the namespace of the newly created namespace.</p>
<p>The default ConfigMap that is included with this guide contains the following templates:</p>
<ul>
<li><strong>Data Access</strong>: <code>template-hr-data-access.yaml</code></li>
<li><strong>Resource Catalogue</strong>: <code>template-hr-resource-catalogue.yaml</code></li>
<li><strong>Protection</strong>: <code>template-hr-resource-guard.yaml</code></li>
</ul>
<p>Each of these templates is expressed as a flux <code>HelmRelease</code> object that describes the helm chart and values required to deploy the service.</p>
<h4 id="templates-configmap">Templates ConfigMap<a class="headerlink" href="#templates-configmap" title="Permanent link">⚓︎</a></h4>
<p>The templates are provided to the Workspace API as a <code>ConfigMap</code> in the namespace of the Workspace API deployment&hellip;</p>
<p><em>(for full examples see <a href="https://github.com/EOEPCA/deployment-guide/tree/main/deploy/eoepca/workspace-templates">https://github.com/EOEPCA/deployment-guide/tree/main/deploy/eoepca/workspace-templates</a>)</em></p>
<pre><code class="language-yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: workspace-charts
data:
  template-hr-resource-catalogue.yaml: |
    apiVersion: helm.toolkit.fluxcd.io/v2beta1
    kind: HelmRelease
    metadata:
      name: rm-resource-catalogue
    spec:
      interval: 5m
      chart:
        spec:
          chart: rm-resource-catalogue
          version: 1.2.0
          sourceRef:
            kind: HelmRepository
            name: eoepca
            namespace: rm
      values:
        ...
  template-hr-data-access.yaml: |
    apiVersion: helm.toolkit.fluxcd.io/v2beta1
    kind: HelmRelease
    metadata:
      name: vs
    spec:
      interval: 5m
      chart:
        spec:
          chart: data-access
          version: 1.2.5
          sourceRef:
            kind: HelmRepository
            name: eoepca
            namespace: rm
      values:
        ...
  template-hr-resource-guard.yaml: |
    apiVersion: helm.toolkit.fluxcd.io/v2beta1
    kind: HelmRelease
    metadata:
      name: resource-guard
    spec:
      interval: 5m
      chart:
        spec:
          chart: resource-guard
          version: 1.2.1
          sourceRef:
            kind: HelmRepository
            name: eoepca
            namespace: rm
      values:
        ...
</code></pre>
<h4 id="helmrepositories-for-templates">HelmRepositories for Templates<a class="headerlink" href="#helmrepositories-for-templates" title="Permanent link">⚓︎</a></h4>
<p>As can be seen above, the HelmRelease templates rely upon objects of type HelmRepository that define the hosting helm chart repository. Thus, in support of the workspace templates, appropriate HelmRepository objects must be provisioned within the cluster. For example, in support of the above examples that rely upon the <a href="https://eoepca.github.io/helm-charts">EOEPCA Helm Chart Repository</a>&hellip;</p>
<pre><code class="language-yaml">apiVersion: source.toolkit.fluxcd.io/v1beta1
kind: HelmRepository
metadata:
  name: eoepca
  namespace: rm
spec:
  interval: 2m
  url: https://eoepca.github.io/helm-charts/
</code></pre>
<h4 id="helm-template-parameters">Helm Template Parameters<a class="headerlink" href="#helm-template-parameters" title="Permanent link">⚓︎</a></h4>
<p>The Workspace API uses the <a href="https://palletsprojects.com/p/jinja/"><code>jinja2</code> templating engine</a> when applying the HelmReleases for a user workspace. The current parameters are currently supported:</p>
<ul>
<li><strong><code>workspace_name</code></strong><br>
  The name of the workspace - <code>{{ workspace_name }}</code> used to ensure unique naming of cluster resources, such as service ingress</li>
<li><strong><code>default_owner</code></strong><br>
  The <code>uuid</code> of the owner of the workspace - <code>{{ default_owner }}</code> used to initialise the workspace protection</li>
</ul>
<h3 id="protection">Protection<a class="headerlink" href="#protection" title="Permanent link">⚓︎</a></h3>
<p>As described in <a href="../resource-protection">section Resource Protection</a>, the <code>resource-guard</code> component can be inserted into the request path of the Workspace API service to provide access authorization decisions</p>
<pre><code class="language-bash">helm install --version 1.2.1 --values workspace-api-guard-values.yaml workspace-api-guard eoepca/resource-guard
</code></pre>
<p>The <code>resource-guard</code> must be configured with the values applicable to the Workspace API for the <em>Policy Enforcement Point</em> (<code>pep-engine</code>) and the <em>UMA User Agent</em> (<code>uma-user-agent</code>)&hellip;</p>
<p><strong>Example <code>workspace-api-guard-values.yaml</code>&hellip;</strong></p>
<pre><code class="language-yaml">#---------------------------------------------------------------------------
# Global values
#---------------------------------------------------------------------------
global:
  context: workspace-api
  domain: 192.168.49.2.nip.io
  nginxIp: 192.168.49.2
  certManager:
    clusterIssuer: letsencrypt-production
#---------------------------------------------------------------------------
# PEP values
#---------------------------------------------------------------------------
pep-engine:
  configMap:
    asHostname: auth
    pdpHostname: auth
  # customDefaultResources:
  # - name: &quot;Eric's workspace&quot;
  #   description: &quot;Protected Access for eric to his user workspace&quot;
  #   resource_uri: &quot;/workspaces/guide-user-eric&quot;
  #   scopes: []
  #   default_owner: &quot;d3688daa-385d-45b0-8e04-2062e3e2cd86&quot;
  # - name: &quot;Bob's workspace&quot;
  #   description: &quot;Protected Access for bob to his user workspace&quot;
  #   resource_uri: &quot;/workspaces/guide-user-bob&quot;
  #   scopes: []
  #   default_owner: &quot;f12c2592-0332-49f4-a4fb-7063b3c2a889&quot;
  volumeClaim:
    name: eoepca-resman-pvc
    create: false
#---------------------------------------------------------------------------
# UMA User Agent values
#---------------------------------------------------------------------------
uma-user-agent:
  nginxIntegration:
    enabled: true
    hosts:
      - host: workspace-api
        paths:
          - path: /(.*)
            service:
              name: workspace-api
              port: http
    annotations:
      nginx.ingress.kubernetes.io/proxy-read-timeout: &quot;600&quot;
      nginx.ingress.kubernetes.io/enable-cors: &quot;true&quot;
      nginx.ingress.kubernetes.io/rewrite-target: /$1
  client:
    credentialsSecretName: &quot;resman-client&quot;
  logging:
    level: &quot;info&quot;
  unauthorizedResponse: 'Bearer realm=&quot;https://portal.192.168.49.2.nip.io/oidc/authenticate/&quot;'
  openAccess: false
  insecureTlsSkipVerify: true
</code></pre>
<p><strong>NOTES:</strong></p>
<ul>
<li>TLS is enabled by the specification of <code>certManager.clusterIssuer</code></li>
<li>The <code>letsencrypt</code> Cluster Issuer relies upon the deployment being accessible from the public internet via the <code>global.domain</code> DNS name. If this is not the case, e.g. for a local minikube deployment in which this is unlikely to be so. In this case the TLS will fall-back to the self-signed certificate built-in to the nginx ingress controller</li>
<li><code>insecureTlsSkipVerify</code> may be required in the case that good TLS certificates cannot be established, e.g. if letsencrypt cannot be used for a local deployment. Otherwise the certificates offered by login-service <em>Authorization Server</em> will fail validation in the <em>Resource Guard</em>.</li>
<li><code>customDefaultResources</code> can be specified to apply initial protection to the endpoint</li>
</ul>
<h3 id="client-secret">Client Secret<a class="headerlink" href="#client-secret" title="Permanent link">⚓︎</a></h3>
<p>The Resource Guard requires confidential client credentials to be configured through the file <code>client.yaml</code>, delivered via a kubernetes secret..</p>
<p><strong>Example <code>client.yaml</code>&hellip;</strong></p>
<pre><code class="language-yaml">client-id: a98ba66e-e876-46e1-8619-5e130a38d1a4
client-secret: 73914cfc-c7dd-4b54-8807-ce17c3645558
</code></pre>
<p><strong>Example <code>Secret</code>&hellip;</strong></p>
<pre><code class="language-bash">kubectl -n rm create secret generic resman-client \
  --from-file=client.yaml \
  --dry-run=client -o yaml \
  &gt; resman-client-secret.yaml
</code></pre>
<pre><code class="language-yaml">apiVersion: v1
kind: Secret
metadata:
  name: resman-client
  namespace: rm
data:
  client.yaml: Y2xpZW50LWlkOiBhOThiYTY2ZS1lODc2LTQ2ZTEtODYxOS01ZTEzMGEzOGQxYTQKY2xpZW50LXNlY3JldDogNzM5MTRjZmMtYzdkZC00YjU0LTg4MDctY2UxN2MzNjQ1NTU4
</code></pre>
<p>The client credentials are obtained by registration of a client at the login service web interface - e.g. <a href="https://auth.192.168.49.2.nip.io">https://auth.192.168.49.2.nip.io</a>. In addition there is a helper script that can be used to create a basic client and obtain the credentials, as described in <a href="../resource-protection/#client-registration">section Resource Protection</a>&hellip;</p>
<pre><code class="language-bash">./deploy/bin/register-client auth.192.168.49.2.nip.io &quot;Resource Guard&quot; | tee client.yaml
</code></pre>
<h3 id="workspace-api-usage">Workspace API Usage<a class="headerlink" href="#workspace-api-usage" title="Permanent link">⚓︎</a></h3>
<p>The Workspace API provides a REST interface that is accessed at the endpoint https://workspace-api.192.168.49.2.nip.io/.<br>
See the <a href="https://workspace-api.192.168.49.2.nip.io/docs">Swagger Docs</a>.</p>
<h3 id="additional-information">Additional Information<a class="headerlink" href="#additional-information" title="Permanent link">⚓︎</a></h3>
<p>Additional information regarding the <em>Workspace API</em> can be found at:</p>
<ul>
<li><a href="https://github.com/EOEPCA/helm-charts/tree/main/charts/rm-workspace-api">Helm Chart</a></li>
<li><a href="https://github.com/EOEPCA/rm-workspace-api/wiki">Wiki</a></li>
<li><a href="https://github.com/EOEPCA/rm-workspace-api">GitHub Repository</a></li>
</ul>
<h2 id="bucket-operator">Bucket Operator<a class="headerlink" href="#bucket-operator" title="Permanent link">⚓︎</a></h2>
<p>The Workspace API creates workspaces for individual users. In doing so, dedicated object storage buckets are created associated to each user workspace - for self-contained storage of user owned resources (data, processing applications, etc.).</p>
<p>The bucket creation relies upon the object storage services of the underlying cloud infrastructure. We have created a <code>Bucket</code> abstraction as a Kubernetes <code>Custom Resource Definition</code>. This is served by a <code>Bucket Operator</code> service that deploys into the Kubernetes cluster to satisfy requests for resources of type <code>Bucket</code>.</p>
<p>We provide a <code>Bucket Operator</code> implementation that currently supports the creation of buckets in OpenStack object storage - currently tested only on the CREODIAS (Cloudferro).</p>
<p>The <em>Bucket Operator</em> is deployed via the <code>rm-bucket-operator</code> helm chart from the <a href="https://eoepca.github.io/helm-charts">EOEPCA Helm Chart Repository</a>.</p>
<p>The chart is configured via values that are fully documented in the <a href="https://github.com/EOEPCA/helm-charts/tree/main/charts/rm-bucket-operator#readme">README for the <code>um-bucket-operator</code> chart</a>.</p>
<pre><code class="language-bash">helm install --version 0.9.9 --values bucket-operator-values.yaml bucket-operator eoepca/rm-bucket-operator
</code></pre>
<h3 id="values_1">Values<a class="headerlink" href="#values_1" title="Permanent link">⚓︎</a></h3>
<p>At minimum, values for the following attributes should be specified:</p>
<ul>
<li>The fully-qualified public URL for the service</li>
<li>OpenStack access details</li>
<li>Cluster Issuer for TLS</li>
</ul>
<p>Example <code>bucket-operator-values.yaml</code>&hellip;</p>
<pre><code class="language-yaml">domain: 192.168.49.2.nip.io
data:
  OS_MEMBERROLEID: &quot;9ee2ff9ee4384b1894a90878d3e92bab&quot;
  OS_SERVICEPROJECTID: &quot;d21467d0a0414252a79e29d38f03ff98&quot;
  USER_EMAIL_PATTERN: &quot;eoepca+&lt;name&gt;@192.168.49.2.nip.io&quot;
ingress:
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-production
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/enable-cors: &quot;true&quot;
    nginx.ingress.kubernetes.io/proxy-read-timeout: &quot;600&quot;
</code></pre>
<h3 id="openstack-secret">OpenStack Secret<a class="headerlink" href="#openstack-secret" title="Permanent link">⚓︎</a></h3>
<p>The <code>Bucket Operator</code> requires privileged access to the OpenStack API, for which credentials are required. These are provided via a Kubernetes secret named <code>openstack</code> created in the namespace of the Bucket Operator.<br>
For example&hellip;</p>
<pre><code>kubectl -n rm create secret generic openstack \
  --from-literal=username=&quot;${OS_USERNAME}&quot; \
  --from-literal=password=&quot;${OS_PASSWORD}&quot; \
  --from-literal=domainname=&quot;${OS_DOMAINNAME}&quot;
</code></pre>
<p>See the <a href="https://github.com/EOEPCA/rm-bucket-operator#readme">README for the Bucket Operator</a>, which describes the configuration required for integration with your OpenStack account.</p>
<p>For a worked example see our <a href="../../examples/scripted-example-deployment">Scripted Example Deployment</a> - in particular:</p>
<ul>
<li><a href="../../examples/scripted-example-deployment/#openstack-configuration">Openstack Configuration</a></li>
<li><a href="https://github.com/EOEPCA/deployment-guide/blob/main/deploy/eoepca/bucket-operator.sh">Deployment Script</a></li>
</ul>

              
            </article>
            
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../data-access/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Data Access" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Data Access
            </div>
          </div>
        </a>
      
      
        
        <a href="../container-registry/" class="md-footer__link md-footer__link--next" aria-label="Next: Container Registry" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Container Registry
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "toc.integrate", "navigation.top"], "search": "../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.0238f547.min.js"></script>
      
    
  </body>
</html>