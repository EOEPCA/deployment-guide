
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://deployment-guide.docs.eoepca.org/current/quickstart/scripted-deployment/">
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.8">
    
    
      
        <title>Scripted Deployment - EOEPCA Deployment Guide</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#scripted-deployment" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../../..">
    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          
        </aside>
      </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="EOEPCA Deployment Guide" class="md-header__button md-logo" aria-label="EOEPCA Deployment Guide" data-md-component="logo">
      
  <img src="../../img/favicon.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EOEPCA Deployment Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Scripted Deployment
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/EOEPCA/deployment-guide" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link md-tabs__link--active">
        Deployment Guide
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="EOEPCA Deployment Guide" class="md-nav__button md-logo" aria-label="EOEPCA Deployment Guide" data-md-component="logo">
      
  <img src="../../img/favicon.ico" alt="logo">

    </a>
    EOEPCA Deployment Guide
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/EOEPCA/deployment-guide" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Deployment Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deployment Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Deployment Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2" type="checkbox" id="__nav_1_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1_2">
          Quick Start
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Quick Start" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          Quick Start
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        Quick Start
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Scripted Deployment
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Scripted Deployment
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    Environment Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openstack-configuration" class="md-nav__link">
    Openstack Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-line-arguments" class="md-nav__link">
    Command-line Arguments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#private-deployment" class="md-nav__link">
    Private Deployment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    Deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protection" class="md-nav__link">
    Protection
  </a>
  
    <nav class="md-nav" aria-label="Protection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-test-users" class="md-nav__link">
    Create Test Users
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apply-protection" class="md-nav__link">
    Apply Protection
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-user-workspaces" class="md-nav__link">
    Create User Workspaces
  </a>
  
    <nav class="md-nav" aria-label="Create User Workspaces">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-workspace-swagger-ui" class="md-nav__link">
    Using Workspace Swagger UI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-curl" class="md-nav__link">
    Using curl
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-create-workspace-helper-script" class="md-nav__link">
    Using create-workspace helper script
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    Clean-up
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../simple-deployment/" class="md-nav__link">
        Simple Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../processing-deployment/" class="md-nav__link">
        Processing Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../creodias-deployment/" class="md-nav__link">
        CREODIAS Deployment
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_3" type="checkbox" id="__nav_1_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_3">
          Cluster
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Cluster" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          Cluster
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/prerequisite-tooling/" class="md-nav__link">
        Prerequisite Tooling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/kubernetes/" class="md-nav__link">
        Kubernetes Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/helm-repositories/" class="md-nav__link">
        Helm Repositories
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster/cluster-prerequisites/" class="md-nav__link">
        Cluster Prerequisites
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_4" type="checkbox" id="__nav_1_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_4">
          EOEPCA
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="EOEPCA" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_4">
          <span class="md-nav__icon md-icon"></span>
          EOEPCA
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/persistence/" class="md-nav__link">
        Persistence
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/login-service/" class="md-nav__link">
        Login Service
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/user-profile/" class="md-nav__link">
        User Profile
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/pdp/" class="md-nav__link">
        Policy Decision Point
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/resource-protection/" class="md-nav__link">
        Resource Protection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/ades/" class="md-nav__link">
        Application Deployment & Execution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/resource-catalogue/" class="md-nav__link">
        Resource Catalogue
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/data-access/" class="md-nav__link">
        Data Access
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/workspace/" class="md-nav__link">
        Workspace
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/container-registry/" class="md-nav__link">
        Container Registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eoepca/pde/" class="md-nav__link">
        Processor Development Environment
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="scripted-deployment">Scripted Deployment<a class="headerlink" href="#scripted-deployment" title="Permanent link">⚓︎</a></h1>
<p>The Scripted Deployment provides a demonstration of an example deployment, and can found in the subdirectory <a href="https://github.com/EOEPCA/deployment-guide/blob/main/deploy/eoepca/eoepca.sh"><code>deployment-guide/deploy</code></a> of the source repository for this guide&hellip;</p>
<pre><code class="language-bash">git clone https://github.com/EOEPCA/deployment-guide \
&amp;&amp; cd deployment-guide \
&amp;&amp; ls deploy
</code></pre>
<p>The script <a href="https://github.com/EOEPCA/deployment-guide/blob/main/deploy/eoepca/eoepca.sh"><code>deploy/eoepca/eoepca.sh</code></a> acts as an entry-point to the full system deployment. In order to tailor the deployment for your target environment, the script is configured through environment variables and command-line arguments. By default the script assumes deployment to a local minikube.</p>
<p>The following subsections lead through the steps for a full local deployment. Whilst minikube is assumed, minimal adaptions are required to make the deployment to your existing Kubernetes cluster.</p>
<p>The deployment follows these broad steps:</p>
<ul>
<li><strong>Configuration</strong><br>
  Tailoring of deployment options.</li>
<li><strong>Deployment</strong><br>
  Creation of cluster and deployment of eoepca services.</li>
<li><strong>Protection</strong><br>
  Application of protection for authorized access to services.</li>
</ul>
<p>The Protection step is split from Deployment as there are some manual steps to be performed before the Protection can be applied.</p>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">⚓︎</a></h2>
<p>The script <a href="https://github.com/EOEPCA/deployment-guide/blob/main/deploy/eoepca/eoepca.sh"><code>deploy/eoepca/eoepca.sh</code></a> is configured by some environment variables and command-line arguments.</p>
<h3 id="environment-variables">Environment Variables<a class="headerlink" href="#environment-variables" title="Permanent link">⚓︎</a></h3>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>REQUIRE_&lt;cluster-component></strong></td>
<td>A set of variables that can be used to control which <strong>CLUSTER</strong> components are deployed by the script, as follows (with defaults):<br><code>REQUIRE_MINIKUBE=true</code><br><code>REQUIRE_INGRESS_NGINX=true</code><br><code>REQUIRE_CERT_MANAGER=true</code><br><code>REQUIRE_LETSENCRYPT=true</code><br><code>REQUIRE_SEALED_SECRETS=false</code><br><code>REQUIRE_MINIO=false</code></td>
<td>see description</td>
</tr>
<tr>
<td><strong>REQUIRE_&lt;eoepca-component></strong></td>
<td>A set of variables that can be used to control which <strong>EOEPCA</strong> components are deployed by the script, as follows (with defaults):<br><code>REQUIRE_STORAGE=true</code><br><code>REQUIRE_DUMMY_SERVICE=false</code><br><code>REQUIRE_LOGIN_SERVICE=true</code><br><code>REQUIRE_PDP=true</code><br><code>REQUIRE_USER_PROFILE=true</code><br><code>REQUIRE_ADES=true</code><br><code>REQUIRE_RESOURCE_CATALOGUE=true</code><br><code>REQUIRE_DATA_ACCESS=true</code><br><code>REQUIRE_WORKSPACE_API=true</code><br><code>REQUIRE_BUCKET_OPERATOR=true</code><br><code>REQUIRE_HARBOR=true</code><br><code>REQUIRE_PORTAL=true</code><br><code>REQUIRE_PDE=true</code></td>
<td>see description</td>
</tr>
<tr>
<td><strong>REQUIRE_&lt;protection-component></strong></td>
<td>A set of variables that can be used to control which <strong>PROTECTION</strong> components are deployed by the script, as follows (with defaults):<br><code>REQUIRE_DUMMY_SERVICE_PROTECTION=false</code><br><code>REQUIRE_ADES_PROTECTION=true</code><br><code>REQUIRE_RESOURCE_CATALOGUE_PROTECTION=true</code><br><code>REQUIRE_DATA_ACCESS_PROTECTION=true</code><br><code>REQUIRE_WORKSPACE_API_PROTECTION=true</code></td>
<td>see description</td>
</tr>
<tr>
<td><strong>USE_MINIKUBE_NONE_DRIVER</strong></td>
<td>Force use of the minikube &lsquo;none&rsquo; driver.<br>The &lsquo;none&rsquo; driver has been found to be useful to more easily expose the kubernetes cluster for external access, e.g. via <code>ingress-controller</code>. This, in turn, facilitates the use of letsencrypt to establish TLS certificates.</td>
<td><code>true</code></td>
</tr>
<tr>
<td><strong>MINIKUBE_KUBERNETES_VERSION</strong></td>
<td>The Kubernetes version to be used by minikube<br>Note that the EOEPCA development has been conducted primarily using version 1.22.5.</td>
<td><code>v1.22.5</code></td>
</tr>
<tr>
<td><strong>MINIKUBE_MEMORY_AMOUNT</strong></td>
<td>Amount of memory to allocate to the docker containers used by minikube to implement the cluster.</td>
<td><code>12g</code></td>
</tr>
<tr>
<td><strong>USE_METALLB</strong></td>
<td>Enable use of minikube&rsquo;s built-in load-balancer.<br>The load-balancer can be used to facilitate exposing services publicly. However, the same can be achieved using minikube&rsquo;s built-in ingress-controller. Therefore, this option is suppressed by default.</td>
<td><code>false</code></td>
</tr>
<tr>
<td><strong>USE_INGRESS_NGINX_HELM</strong></td>
<td>Install the ingress-nginx controller using the published helm chart, rather than relying upon the version that is built-in to minikube. By default we prefer the version that is built in to minikube.</td>
<td><code>false</code></td>
</tr>
<tr>
<td><strong>USE_INGRESS_NGINX_LOADBALANCER</strong></td>
<td>Patch the built-in minikube nginx-ingress-controller to offer a service of type <code>LoadBalancer</code>, rather than the default <code>NodePort</code>. It was initially thought that this would be necessary to achieve public access to the ingress services - but was subsequently found that the default <code>NodePort</code> configuration of the ingress-controller was sufficient. This option is left in case it proves useful.<br>Only applicable for <code>USE_INGRESS_NGINX_HELM=false</code> (i.e. when using the minikube built-in )</td>
<td><code>false</code></td>
</tr>
<tr>
<td><strong>OPEN_INGRESS</strong></td>
<td>Create &lsquo;open&rsquo; ingress endpoints that are not subject to authorization protection. For a secure system the open endpoints should be disabled (<code>false</code>) and access to resource should be protected via <a href="../../eoepca/resource-protection/">ingress that apply protection</a></td>
<td><code>false</code></td>
</tr>
<tr>
<td><strong>USE_TLS</strong></td>
<td>Indicates whether TLS will be configured for service <code>Ingress</code> rules.<br>If not (i.e. <code>USE_TLS=false</code>), then the ingress-controller is configured to disable <code>ssl-redirect</code>, and <code>TLS_CLUSTER_ISSUER=notls</code> is set.</td>
<td><code>true</code></td>
</tr>
<tr>
<td><strong>TLS_CLUSTER_ISSUER</strong></td>
<td>The name of the ClusterIssuer to satisfy ingress tls certificates.<br>Out-of-the-box <em>ClusterIssuer</em> instances are configured in the file <code>deploy/cluster/letsencrypt.sh</code>.</td>
<td><code>letsencrypt-staging</code></td>
</tr>
<tr>
<td><strong>LOGIN_SERVICE_ADMIN_PASSWORD</strong></td>
<td>Initial password for the <code>admin</code> user in the login-service.</td>
<td><code>changeme</code></td>
</tr>
<tr>
<td><strong>MINIO_ROOT_USER</strong></td>
<td>Name of the &lsquo;root&rsquo; user for the Minio object storage service.</td>
<td><code>eoepca</code></td>
</tr>
<tr>
<td><strong>MINIO_ROOT_PASSWORD</strong></td>
<td>Password for the &lsquo;root&rsquo; user for the Minio object storage service.</td>
<td><code>changeme</code></td>
</tr>
<tr>
<td><strong>HARBOR_ADMIN_PASSWORD</strong></td>
<td>Password for the &lsquo;admin&rsquo; user for the Harbor artefact registry service.</td>
<td><code>changeme</code></td>
</tr>
<tr>
<td><strong>STAGEOUT_TARGET</strong></td>
<td>Configures the ADES with the destination to which it should push processing results:<br><code>workspace</code> - via the Workspace API<br><code>minio</code> - to minio S3 object storage</td>
<td><code>workspace</code></td>
</tr>
<tr>
<td><strong>INSTALL_FLUX</strong></td>
<td>The Workspace API relies upon <a href="https://fluxcd.io/">Flux CI/CD</a>, and has the capability to install the required flux components to the cluster. If your deployment already has flux installed then set this value <code>false</code> to suppress the Workspace API flux install</td>
<td><code>true</code></td>
</tr>
<tr>
<td><strong>CREODIAS_DATA_SPECIFICATION</strong></td>
<td>Apply the data specification to harvest from the CREODIAS data offering into the resource-catalogue and data-access services.<br><em>Can only be used when running in the CREODIAS (Cloudferro) cloud, with access to the <code>eodata</code> network.</em></td>
<td><code>false</code></td>
</tr>
</tbody>
</table>
<h3 id="openstack-configuration">Openstack Configuration<a class="headerlink" href="#openstack-configuration" title="Permanent link">⚓︎</a></h3>
<p>There are some additional environment variables that configure the <code>BucketOperator</code> with details of the infrastructure Openstack layer.</p>
<p>NOTE that this is only applicable for an Openstack deployment and has only been tested on the CREODIAS.</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>OS_DOMAINNAME</strong></td>
<td>Openstack domain of the admin account in the cloud provider.</td>
<td><code>cloud_XXXXX</code></td>
</tr>
<tr>
<td><strong>OS_USERNAME</strong></td>
<td>Openstack username of the admin account in the cloud provider.</td>
<td><code>user@cloud.com</code></td>
</tr>
<tr>
<td><strong>OS_PASSWORD</strong></td>
<td>Openstack password of the admin account in the cloud provider.</td>
<td><code>none</code></td>
</tr>
<tr>
<td><strong>OS_MEMBERROLEID</strong></td>
<td>ID of a specific role (e.g. the &lsquo;<em>member</em>&lsquo; role) for operations users (to allow administration), e.g. <code>7fe2ff9ee5384b1894a90838d3e92bab</code>.</td>
<td><code>none</code></td>
</tr>
<tr>
<td><strong>OS_SERVICEPROJECTID</strong></td>
<td>ID of a project containing the user identity requiring write access to the created user buckets, e.g. <code>573916ef342a4bf1aea807d0c6058c1e</code>.</td>
<td><code>none</code></td>
</tr>
<tr>
<td><strong>USER_EMAIL_PATTERN</strong></td>
<td>Email associated to the created user within the created user project.<br><em>Note: <code>&lt;name&gt;</code> is templated and will be replaced.</em></td>
<td><code>eoepca-&lt;name&gt;@platform.com</code></td>
</tr>
</tbody>
</table>
<h3 id="command-line-arguments">Command-line Arguments<a class="headerlink" href="#command-line-arguments" title="Permanent link">⚓︎</a></h3>
<p>The eoepca.sh script is further configured via command-line arguments&hellip;</p>
<p><strong><code>Usage: eoepca.sh &lt;action&gt; &lt;cluster-name&gt; &lt;public-ip&gt; &lt;domain&gt;</code></strong></p>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>action</strong></td>
<td>Action to perform: <code>apply</code> | <code>delete</code> | <code>template</code>.<br><code>apply</code> makes the deployment<br><code>delete</code> removes the deployment<br><code>template</code> outputs generated kubernetes yaml to stdout</td>
<td><code>apply</code></td>
</tr>
<tr>
<td><strong>cluster-name</strong></td>
<td>The name of the minikube &lsquo;profile&rsquo; for the created minikube cluster.<br>Note that this option is ignored if <code>USE_MINIKUBE_NONE_DRIVER=true</code> as the &lsquo;none&rsquo; driver does not support multiple profiles.</td>
<td><code>eoepca</code></td>
</tr>
<tr>
<td><strong>public-ip</strong></td>
<td>The public IP address through which the deployment is exposed via the ingress-controller.<br>By default, the value is deduced from the assigned cluster minikube IP address - ref. command <code>minikube ip</code>.</td>
<td><code>&lt;minikube-ip&gt;</code></td>
</tr>
<tr>
<td><strong>domain</strong></td>
<td>The DNS domain name through which the deployment is accessed. Forms the stem for all service hostnames in the ingress rules - i.e. <code>&lt;service-name&gt;.&lt;domain&gt;</code>.<br>By default, the value is deduced from the assigned cluster minikube IP address, using <code>nip.io</code> to establish a DNS lookup - i.e. <code>&lt;minikube ip&gt;.nip.io</code>.</td>
<td><code>&lt;minikube ip&gt;.nip.io</code></td>
</tr>
</tbody>
</table>
<h3 id="private-deployment">Private Deployment<a class="headerlink" href="#private-deployment" title="Permanent link">⚓︎</a></h3>
<p>In the case that a &lsquo;private&rsquo; deployment is required - i.e. with no public IP - then the following configuration selections should be made:</p>
<ul>
<li><code>public_ip</code> - leave blank to fall-back to minikube ip default</li>
<li><code>domain</code> - leave blank to fall-back to minikube ip default</li>
<li><code>USE_MINIKUBE_NONE_DRIVER=false</code> - the <code>none</code> driver is mostly useful only with a public IP</li>
<li><code>USE_TLS=false</code> - difficult to configure letsencrypt without a public IP</li>
</ul>
<h2 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">⚓︎</a></h2>
<p>The deployment is initiated by setting the appropriate <a href="#environment-variables">environment variables</a> and invoking the <code>eoepca.sh</code> script with suitable <a href="#command-line-arguments">command-line arguments</a>. You may find it convenient to do so using a wrapper script that customises the environment varaibles according to your cluster, and then invokes the <code>eoepca.sh</code> script.</p>
<p>Customised examples are provided for Simple, CREODIAS and Processing deployments.</p>
<p><strong><em>NOTE that if a prior deployment has been attempted then, before redeploying, a clean-up should be performed as described in the <a href="#clean-up">Clean-up</a> section below. This is particularly important in the case that the minikube &lsquo;none&rsquo; driver is used, as the persistence is maintained on the host and so is not naturally removed when the minikube cluster is destroyed.</em></strong></p>
<p>Initiate the deployment&hellip;</p>
<pre><code class="language-bash">./deploy/eoepca/eoepca.sh apply &quot;&lt;cluster-name&gt;&quot; &quot;&lt;public-ip&gt;&quot; &quot;&lt;domain&gt;&quot;
</code></pre>
<p>The deployment takes 10+ minutes - depending on the resources of your host/cluster. The progress can be monitored&hellip;</p>
<pre><code class="language-bash">kubectl get pods -A
</code></pre>
<p>The deployment is ready once all pods are either <code>Running</code> or <code>Completed</code>. This can be further confirmed by accessing the login-service web interface at <code>https://auth.&lt;domain&gt;/</code> and logging in as user <code>admin</code> using the credentials configured via <code>LOGIN_SERVICE_ADMIN_PASSWORD</code>.</p>
<h2 id="protection">Protection<a class="headerlink" href="#protection" title="Permanent link">⚓︎</a></h2>
<p>The protection of resource server endpoints is applied with the script <code>deploy/eoepca/eoepca-protection.sh</code>. This script should be executed with environment variables and command-line options that are consistent with those of the main deployment (ref. script <code>eoepca.sh</code>).</p>
<p>The script <code>eoepca-protection.sh</code> introduces two users <code>eric</code> and <code>bob</code> to demonstrate the application of authorized access to various service endpoints: ADES, Workspace API and dummy-service (simple endpoint used for debugging).</p>
<p>Thus, the users must <a href="#create-test-users">first be created</a> in the login-service and their unique IDs passed to the protection script.</p>
<pre><code>Usage: eoepca-protection.sh &lt;action&gt; &lt;eric-id&gt; &lt;bob-id&gt; &lt;public-ip&gt; &lt;domain&gt;
</code></pre>
<h3 id="create-test-users">Create Test Users<a class="headerlink" href="#create-test-users" title="Permanent link">⚓︎</a></h3>
<p>Access the login-service web interface (<code>https://auth.&lt;domain&gt;/</code>) as user admin using the credentials configured via <code>LOGIN_SERVICE_ADMIN_PASSWORD</code>.</p>
<p>Select <code>Users -&gt; Add person</code> to add users <code>eric</code> and <code>bob</code> (dummy details can be used). Note the <code>Inum</code> (unique user ID) for each user for use with the <code>eoepca-protection.sh</code> script.</p>
<h3 id="apply-protection">Apply Protection<a class="headerlink" href="#apply-protection" title="Permanent link">⚓︎</a></h3>
<p>Apply the protection&hellip;<br>
<em>Ensure that the script is executed with the environment variables and command-line options that are consistent with those of the main <a href="#deployment">deployment</a>.</em></p>
<pre><code class="language-bash">./deploy/eoepca/eoepca-protection.sh apply &quot;&lt;eric-id&gt;&quot; &quot;&lt;bob-id&gt;&quot; &quot;&lt;public-ip&gt;&quot; &quot;&lt;domain&gt;&quot;
</code></pre>
<h2 id="create-user-workspaces">Create User Workspaces<a class="headerlink" href="#create-user-workspaces" title="Permanent link">⚓︎</a></h2>
<p>The protection steps created the test users <code>eric</code> and <code>bob</code>. For completeness we use the Workspace API to create their user workspaces, which hold their personal resources (data, processing results, etc.) within the platform - see <a href="../workspace/">Workspace</a>.</p>
<h3 id="using-workspace-swagger-ui">Using Workspace Swagger UI<a class="headerlink" href="#using-workspace-swagger-ui" title="Permanent link">⚓︎</a></h3>
<p>The Workspace API provides a Swagger UI that facilitates interaction with the API - at the URL <code>https://workspace-api.&lt;domain&gt;/docs#</code>. Access to The Workspace API is protected, such that the necessary access tokens must be supplied in requests, which is most easily achieved by logging in via the &lsquo;portal&rsquo;.</p>
<p>The portal is accessed at <code>https://portal.&lt;domain&gt;/</code>. It is a rudimentary web service that facilitates establishing the appropriate tokens in the user&rsquo;s browser context. Login to the portal as the <code>admin</code> user, using the configured credentials.</p>
<p>Access the Workspace Swagger UI at <code>https://workspace-api.&lt;domain&gt;/docs</code>. Workspaces are created using <code>POST  /workspaces</code> <strong>(Create Workspace)</strong>. Expand the node and select <code>Try it out</code>. Complete the request body, such as&hellip;</p>
<pre><code class="language-json">{
  &quot;preferred_name&quot;: &quot;eric&quot;,
  &quot;default_owner&quot;: &quot;d95b0c2b-ea74-4b3f-9c6a-85198dec974d&quot;
}
</code></pre>
<p>&hellip;where the <code>default_owner</code> is the user ID (<code>Inum</code>) for the user - thus protecting the created workspace for the identified user.</p>
<h3 id="using-curl">Using <code>curl</code><a class="headerlink" href="#using-curl" title="Permanent link">⚓︎</a></h3>
<p>The same can be achieved with a straight http request, for example using <code>curl</code>&hellip;</p>
<pre><code class="language-bash">curl -X 'POST' \
  'https://workspace-api.192.168.49.123.nip.io/workspaces' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -H 'X-User-Id: &lt;admin-id-token&gt;' \
  -d '{
  &quot;preferred_name&quot;: &quot;&lt;workspace-name&gt;&quot;,
  &quot;default_owner&quot;: &quot;&lt;user-inum&gt;&quot;
}'
</code></pre>
<p>Values must be provided for:</p>
<ul>
<li><code>admin-id-token</code> - User ID token for the admin user</li>
<li><code>workspace-name</code> - name of the workspace, typically the username</li>
<li><code>user-inum</code> - the ID of the user for which the created workspace will be protected</li>
</ul>
<p>The ID token for the <code>admin</code> user can be obtained with a call to the token endpoint of the Login Service - supplying the credentials for the <code>admin</code> user and the pre-registered client&hellip;</p>
<pre><code class="language-bash">curl -L -X POST 'https://auth.&lt;domain&gt;/oxauth/restv1/token' \
  -H 'Cache-Control: no-cache' \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  --data-urlencode 'scope=openid user_name is_operator' \
  --data-urlencode 'grant_type=password' \
  --data-urlencode 'username=admin' \
  --data-urlencode 'password=&lt;admin-password&gt;' \
  --data-urlencode 'client_id=&lt;client-id&gt;' \
  --data-urlencode 'client_secret=&lt;client-secret&gt;'
</code></pre>
<p>A json response is returned, in which the field <code>id_token</code> provides the user ID token for the <code>admin</code> user.</p>
<h3 id="using-create-workspace-helper-script">Using <code>create-workspace</code> helper script<a class="headerlink" href="#using-create-workspace-helper-script" title="Permanent link">⚓︎</a></h3>
<p>As an aide there is a helper script <a href="https://github.com/EOEPCA/deployment-guide/blob/main/deploy/bin/create-workspace"><code>create-workspace</code></a>. The script is available in the <a href="https://github.com/EOEPCA/deployment-guide"><code>deployment-guide</code> repository</a>, and can be obtained as follows&hellip;</p>
<pre><code class="language-bash">git clone git@github.com:EOEPCA/deployment-guide
cd deployment-guide
</code></pre>
<p>The <code>create-workspace</code> helper script requires some command-line arguments&hellip;</p>
<pre><code>Usage:
  create-workspace &lt;domain&gt; &lt;user&gt; &lt;user-inum&gt; [&lt;client-id&gt; &lt;client-secret&gt;]
</code></pre>
<p>For example&hellip;</p>
<pre><code class="language-bash">./deploy/bin/create-workspace 192.168.49.123.nip.io eric d95b0c2b-ea74-4b3f-9c6a-85198dec974d
</code></pre>
<p>The script prompts for the password of the <code>admin</code> user.</p>
<p>By default <code>&lt;client-id&gt;</code> and <code>&lt;client-secret&gt;</code> are read from the <code>client.yaml</code> file that is created by the deployment script, which auto-registers a Login Service client. Thus, these args can be ommited to use the default client credentials.</p>
<h2 id="clean-up">Clean-up<a class="headerlink" href="#clean-up" title="Permanent link">⚓︎</a></h2>
<p>Before initiating a fresh deployment, if a prior deployment has been attempted, then it is necessary to remove any persistent artefacts of the prior deployment. This includes&hellip;</p>
<ol>
<li>
<p><strong>Minikube cluster</strong><br>
  Delete the minikube cluster&hellip;<br>
  <code>minikube delete</code><br>
  If necessary specify the cluster (profile)&hellip;<br>
  <code>minikube -p &lt;profile&gt; delete</code><br></p>
</li>
<li>
<p><strong>Persistent Data</strong><br>
  In the case that the minikube <code>none</code> driver is used, the persistence is maintained on the host and so is not naturally removed when the minikube cluster is destroyed. In this case, the minikube <code>standard</code> <em>StorageClass</em> is fulfilled by the <code>hostpath</code> provisioner, whose persistence is removed as follows&hellip;<br>
  <code>sudo rm -rf /tmp/hostpath-provisioner</code></p>
</li>
<li>
<p><strong>Client Credentials</strong><br>
  During the deployment a client of the Authorisation Server is registered, and its credentials stored for reuse in the file <code>client.yaml</code>. Once the cluster has been destroyed, then these client credentials become stale and so should be removed to avoid polluting subsequent deployments&hellip;<br>
  <code>rm -rf ./deploy/eoepca/client.yaml</code></p>
</li>
</ol>
<p>There is a helper script <a href="https://github.com/EOEPCA/deployment-guide/blob/main/deploy/cluster/clean"><code>clean</code></a> that can be used for steps 2 and 3 above, (the script does not delete the cluster).</p>
<pre><code class="language-bash">./deploy/cluster/clean
</code></pre>

              
            </article>
            
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../quickstart/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Quick Start" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Quick Start
            </div>
          </div>
        </a>
      
      
        
        <a href="../simple-deployment/" class="md-footer__link md-footer__link--next" aria-label="Next: Simple Deployment" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Simple Deployment
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "toc.integrate", "navigation.top"], "search": "../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.0238f547.min.js"></script>
      
    
  </body>
</html>